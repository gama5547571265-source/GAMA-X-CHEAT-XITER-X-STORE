    <!DOCTYPE html>
    <html lang="ar" dir="rtl">
    <head>
        <link rel="icon" type="image/x-icon" href="hero-image.jpg">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>GAMA X CHEAT - متجر الألعاب الاحترافي</title>
        <style>
  .floating-card,.login-container{border-radius:20px;text-align:center}.about-text h3,.about-text p,.btn,.contact-info,.feature-item,.floating-card,.login-container,.section-title{text-align:center}.btn,.contact-btn,.feature-item,.logout-btn,.nav-links a,.product-card,.profile-btn,.profile-dropdown,body{transition:.3s}.add-to-cart,.btn,.cart-btn,.logout-btn,.profile-btn,.quantity-btn,.star,.theme-toggle{cursor:pointer}.btn,.contact-btn,.footer-section a,.login-footer a,.nav-links a,.profile-link{text-decoration:none}.chat-input input,.checkout-form input[type=datetime-local],.copy-btn,.filter-btn,.login-form input,body{font-family:Tajawal,sans-serif}:root{--primary:#0066FF;--secondary:#0080FF;--accent:#66B2FF;--success:#4ecdc4;--dark:#0F0F0F;--light:#F5F5F5;--text:#F5F5F5}[data-theme=dark]{--primary:#3399FF;--secondary:#66B2FF;--accent:#99CCFF;--dark:#1a1a1a;--light:#0F0F0F;--text:#F5F5F5}*{margin:0;padding:0;box-sizing:border-box}body{background:var(--dark);color:var(--text);line-height:1.6;scroll-behavior:smooth}@keyframes glow{0%,100%{box-shadow:0 0 20px rgba(0,102,255,.5)}50%{box-shadow:0 0 40px rgba(0,102,255,.8)}}@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(0,102,255,.7)}70%{box-shadow:0 0 0 15px rgba(0,102,255,0)}100%{box-shadow:0 0 0 0 rgba(0,102,255,0)}}@keyframes slideUp{from{transform:translateY(50px);opacity:0}to{transform:translateY(0);opacity:1}}.login-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,var(--dark) 0,#1a1a1a 100%);display:flex;justify-content:center;align-items:center;z-index:10000;animation:.5s ease-out slideUp}.login-container{background:rgba(255,255,255,.1);backdrop-filter:blur(20px);padding:3rem;width:90%;max-width:400px;border:1px solid rgba(0,102,255,.3);box-shadow:0 20px 40px rgba(0,0,0,.3)}.floating-card,.header,.product-card{backdrop-filter:blur(10px)}.cart-items,.login-header{margin-bottom:2rem}.feature-item i,.floating-card i,.loading-product i,.login-header i{font-size:3rem;color:var(--primary);margin-bottom:1rem}.login-header h1{color:var(--primary);font-size:2rem;margin-bottom:.5rem;font-weight:900}.loading-product p,.login-footer p,.login-header p{color:var(--text);opacity:.8}.login-form{animation:.6s ease-out slideUp}.login-form .form-group{margin-bottom:1.5rem;text-align:right}.login-form label{display:block;margin-bottom:.5rem;color:var(--text);font-weight:600;display:flex;align-items:center;gap:.5rem}.login-form input{width:100%;padding:1rem;background:rgba(255,255,255,.1);border:1px solid rgba(0,102,255,.3);border-radius:10px;color:var(--text);transition:.3s}.checkout-form input:focus,.checkout-form textarea:focus,.form-group input:focus,.form-group textarea:focus,.login-form input:focus{outline:0;border-color:var(--primary);box-shadow:0 0 0 2px rgba(0,102,255,.2)}.login-btn{width:100%;padding:1rem;margin-bottom:1rem}.login-footer{margin-top:1rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,.1)}.login-footer a{color:var(--primary);font-weight:600}.login-footer a:hover{text-decoration:underline}.hidden{display:none!important}.user-profile{position:relative}.profile-btn{background:var(--primary);color:#fff;border:none;padding:.5rem 1rem;border-radius:50px;display:flex;align-items:center;gap:.5rem}.logo,.logout-btn{align-items:center}.add-to-cart:hover,.cart-btn:hover,.chat-input button:hover,.contact-btn:hover,.profile-btn:hover,.theme-toggle:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,102,255,.4)}.profile-dropdown{position:absolute;top:100%;left:0;background:var(--dark);border:1px solid rgba(0,102,255,.3);border-radius:10px;padding:1rem;min-width:200px;box-shadow:0 10px 30px rgba(0,0,0,.3);opacity:0;visibility:hidden;transform:translateY(-10px);z-index:1000}.user-profile:hover .profile-dropdown{opacity:1;visibility:visible;transform:translateY(0)}.profile-info{padding-bottom:1rem;border-bottom:1px solid rgba(255,255,255,.1);margin-bottom:1rem}.hero,.nav{max-width:1200px;margin:0 auto;display:flex}.profile-info strong{color:var(--text);display:block;margin-bottom:.25rem}.profile-info span{color:var(--text);opacity:.7;font-size:.9rem}.logout-btn{width:100%;background:0 0;color:var(--text);border:1px solid rgba(255,255,255,.2);padding:.75rem;border-radius:5px;display:flex;justify-content:center;gap:.5rem}.logout-btn:hover{background:rgba(220,53,69,.1);border-color:#dc3545;color:#dc3545}.header{background:rgba(15,15,15,.95);position:fixed;top:0;width:100%;z-index:1000;box-shadow:0 2px 20px rgba(0,0,0,.3);border-bottom:1px solid rgba(0,102,255,.2)}.about-content,.add-testimonial-form,.contact-content,.floating-card,.product-card{box-shadow:0 10px 30px rgba(0,0,0,.3)}.nav{justify-content:space-between;align-items:center;padding:1rem 2rem}.cart-btn,.nav-links a,.theme-toggle{padding:.5rem 1rem;position:relative}.logo{display:flex;font-size:1.5rem;font-weight:900;color:var(--primary);text-shadow:0 0 10px rgba(0,102,255,.5)}.logo i{margin-left:.5rem}.nav-links{display:flex;gap:2rem}.nav-links a{color:var(--text);font-weight:600;border-radius:5px}.nav-links a.active,.nav-links a:hover{color:var(--primary);background:rgba(0,102,255,.1)}.nav-links a.active::after{content:'';position:absolute;bottom:-5px;left:0;width:100%;height:2px;background:var(--primary)}.nav-actions{display:flex;gap:1rem;align-items:center}.cart-btn,.theme-toggle{background:var(--primary);color:#fff;border:none;border-radius:50px;display:flex;align-items:center;gap:.5rem;overflow:hidden}.cart-count{background:var(--secondary);color:#fff;border-radius:50%;padding:.2rem .5rem;font-size:.8rem;font-weight:700}.hero{min-height:100vh;align-items:center;padding:6rem 2rem 2rem;gap:4rem;background:linear-gradient(135deg,var(--dark) 0,#1a1a1a 100%);position:relative;overflow:hidden}.hero::before{content:'';position:absolute;top:-50%;right:-20%;width:600px;height:600px;border-radius:50%;background:linear-gradient(135deg,var(--primary) 0,var(--secondary) 100%);opacity:.1;z-index:0}.contact-item a:hover,.footer-section a:hover{opacity:1;color:var(--primary)}.hero-content{flex:1;position:relative;z-index:1}.hero-title{font-size:3.5rem;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:1.5rem;line-height:1.2;font-weight:900}.hero-description{font-size:1.2rem;color:var(--text);opacity:.8;margin-bottom:2rem;max-width:500px}.cart-actions,.hero-buttons{display:flex;gap:1rem}.btn{padding:1rem 2rem;border:none;border-radius:50px;font-size:1rem;font-weight:600;display:inline-block;position:relative;overflow:hidden}.btn-save,.btn.primary{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff}.btn.secondary{background:0 0;color:var(--primary);border:2px solid var(--primary)}.nav-links a::after,.section-title::after{position:absolute;background:linear-gradient(90deg,var(--primary),var(--secondary));content:''}.btn:hover{transform:translateY(-3px);box-shadow:0 10px 25px rgba(0,102,255,.3)}.floating-card{background:rgba(255,255,255,.1);padding:2rem;animation:3s ease-in-out infinite float;border:1px solid rgba(255,255,255,.2)}.floating-card h3{color:var(--text);font-weight:600}.about{padding:5rem 2rem;background:var(--dark);position:relative}.container{max-width:1200px;margin:0 auto}.section-title{font-size:2.5rem;margin-bottom:3rem;color:var(--text);position:relative}.section-title::after{bottom:-10px;left:50%;transform:translateX(-50%);width:100px;height:3px;border-radius:2px}.about-content,.contact-content{background:rgba(255,255,255,.05);backdrop-filter:blur(10px);border-radius:20px;padding:3rem;border:1px solid rgba(0,102,255,.2)}.about-text h3{font-size:2rem;color:var(--primary);margin-bottom:1.5rem}.about-text p{font-size:1.1rem;line-height:1.8;margin-bottom:2rem;opacity:.9}.features-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:2rem;margin:3rem 0}.feature-item{background:rgba(255,255,255,.05);padding:2rem;border-radius:15px;border:1px solid rgba(0,102,255,.2)}.feature-item:hover,.testimonial-card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,102,255,.2);border-color:var(--primary)}.feature-item h4{font-size:1.3rem;margin-bottom:1rem;color:var(--text)}.feature-item p{font-size:.9rem;opacity:.8}.contact-info{margin-top:3rem}.contact-info h4{font-size:1.5rem;margin-bottom:1.5rem;color:var(--primary)}.contact-methods{display:flex;gap:1rem;justify-content:center;flex-wrap:wrap}.contact-btn{display:flex;align-items:center;gap:.5rem;padding:1rem 2rem;background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;border-radius:50px;font-weight:600}.contact,.products{padding:5rem 2rem;background:linear-gradient(135deg,#1a1a1a 0,var(--dark) 100%)}.products-grid{display:grid;gap:2rem;justify-content:center}.products-grid:has(.product-card:only-child){grid-template-columns:minmax(300px,500px);justify-content:center}.products-grid:has(.product-card:nth-child(2):last-child){grid-template-columns:repeat(2,minmax(300px,1fr))}.products-grid:has(.product-card:nth-child(3)){grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}.product-card{background:rgba(255,255,255,.05);border-radius:20px;overflow:hidden;border:1px solid rgba(0,102,255,.2);display:flex;flex-direction:column;height:100%;position:relative}.add-to-cart,.product-image-fallback{background:linear-gradient(135deg,var(--primary),var(--secondary));display:flex}.product-card:hover{transform:translateY(-10px);box-shadow:0 20px 40px rgba(0,102,255,.3);border-color:var(--primary)}.product-image-container{position:relative;width:100%;height:250px;overflow:hidden}.product-img{width:100%;height:100%;object-fit:cover;transition:transform .3s}.product-card:hover .product-img{transform:scale(1.05)}.product-image-fallback{width:100%;height:100%;align-items:center;justify-content:center;color:#fff;font-size:3rem}.no-products i,.product-emoji{font-size:4rem}.product-image-fallback.hidden{display:none}.product-info{padding:1.5rem;display:flex;flex-direction:column;flex-grow:1}.product-name{font-size:1.3rem;font-weight:700;margin-bottom:.75rem;color:var(--text);line-height:1.4}.product-description{color:var(--text);opacity:.8;margin-bottom:1rem;line-height:1.6;flex-grow:1;font-size:.95rem}.product-meta{display:flex;justify-content:space-between;align-items:center;margin-top:auto}.product-price{font-size:1.4rem;font-weight:700;color:var(--primary)}.add-to-cart{padding:.75rem 1.5rem;color:#fff;border:none;border-radius:10px;font-size:.9rem;font-weight:600;transition:.3s;align-items:center;gap:.5rem;white-space:nowrap}.loading-product,.no-products{grid-column:1/-1;background:rgba(255,255,255,.05);text-align:center}.no-products{padding:4rem 2rem;border-radius:20px;border:1px solid rgba(0,102,255,.2)}.no-products i{color:var(--primary);margin-bottom:1.5rem}.no-products p{color:var(--text);font-size:1.2rem;margin-bottom:.5rem}.loading-product{padding:3rem;border-radius:15px;border:1px solid rgba(0,102,255,.2)}.testimonials{padding:5rem 2rem;background:var(--dark)}.add-testimonial-form,.testimonial-card{padding:2rem;backdrop-filter:blur(10px)}.testimonials-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:2rem}.contact-info,.footer-content{grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}.testimonial-card{background:rgba(255,255,255,.05);border-radius:15px;border:1px solid rgba(0,102,255,.2);transition:.3s}.testimonial-content{margin-bottom:1rem}.testimonial-text{font-style:italic;line-height:1.6;opacity:.9}.testimonial-author{display:flex;align-items:center;gap:1rem}.author-avatar{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--secondary));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}.author-info h4{color:var(--text);margin-bottom:.25rem}.author-info p{color:var(--primary);font-size:.9rem;opacity:.8}.add-testimonial-form{background:rgba(255,255,255,.05);border-radius:20px;margin-bottom:3rem;border:1px solid rgba(0,102,255,.2)}.add-testimonial-form h3{color:var(--primary);margin-bottom:1.5rem;text-align:center;font-size:1.5rem}.checkout-form .form-group,.form-group{margin-bottom:1.5rem}.checkout-form label,.form-group label{display:block;margin-bottom:.5rem;color:var(--text);font-weight:600}.checkout-form input,.checkout-form textarea,.form-group input,.form-group textarea{width:100%;padding:.75rem;background:rgba(255,255,255,.1);border:1px solid rgba(0,102,255,.3);border-radius:10px;color:var(--text);font-family:Tajawal,sans-serif;transition:.3s}.form-group textarea{resize:vertical;min-height:100px}.rating-stars{display:flex;gap:.5rem;direction:ltr}.star{font-size:2rem;color:#666;transition:.3s}.star.active,.star:hover{color:gold;transform:scale(1.2)}.testimonial-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.author-rating{color:gold;font-size:1rem}.testimonial-date{color:var(--primary);font-size:.8rem;opacity:.7;margin-top:1rem;text-align:left}.contact-info{display:grid;gap:2rem}.contact-item,.contact-item i{display:flex;align-items:center}.contact-item{gap:1rem;padding:1.5rem;background:rgba(255,255,255,.05);border-radius:15px;border:1px solid rgba(0,102,255,.2);transition:.3s}.contact-item:hover{transform:translateY(-3px);box-shadow:0 5px 15px rgba(0,102,255,.2);border-color:var(--primary)}.contact-item i{font-size:2rem;color:var(--primary);width:50px;height:50px;justify-content:center;background:rgba(0,102,255,.1);border-radius:50%}.contact-item h4{color:var(--text);margin-bottom:.5rem}.contact-item a,.contact-item p{color:var(--text);opacity:.8;text-decoration:none;transition:opacity .3s}.footer{background:var(--dark);border-top:1px solid rgba(0,102,255,.2);padding:3rem 0 1rem}.footer-content{display:grid;gap:3rem;margin-bottom:2rem}.footer-section h3{color:var(--primary);margin-bottom:1rem;font-size:1.5rem}.footer-section h4{color:var(--text);margin-bottom:1rem;font-size:1.2rem}.footer-section p{color:var(--text);opacity:.8;line-height:1.6}.footer-section a{display:block;color:var(--text);opacity:.8;margin-bottom:.5rem;transition:.3s}.footer-section a:hover{transform:translateX(5px)}.footer-bottom{text-align:center;padding-top:2rem;border-top:1px solid rgba(255,255,255,.1)}.footer-bottom p{color:var(--text);opacity:.6}.cart-notification{position:fixed;top:100px;right:20px;background:var(--primary);color:#fff;padding:1rem 1.5rem;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.3);z-index:10000;transform:translateX(400px);transition:transform .3s;display:flex;align-items:center;gap:.5rem}.cart-notification.show{transform:translateX(0)}.cart-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:10000;display:flex;justify-content:center;align-items:center;opacity:0;visibility:hidden;transition:.3s}.cart-modal.show,.modal-overlay.active{opacity:1;visibility:visible}.cart-modal-content{background:var(--dark);border:1px solid rgba(0,102,255,.3);border-radius:20px;padding:2rem;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;transform:scale(.8);transition:transform .3s}.cart-btn,.modal-overlay,.profile-link,.theme-toggle{transition:.3s}.cart-modal.show .cart-modal-content,.modal-overlay.active .modal-content{transform:scale(1)}.cart-modal-header,.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;border-bottom:1px solid rgba(255,255,255,.1);padding-bottom:1rem}.cart-item,.order-item{justify-content:space-between}.cart-modal-header h3,.modal-title{color:var(--primary);margin:0}.btn .fa-spin,.remove-btn{margin-right:.5rem}.close-cart,.close-modal{background:0 0;border:none;color:var(--text);font-size:1.5rem;cursor:pointer;padding:.5rem}.quantity-btn,.remove-btn{color:#fff;width:30px;height:30px}.cart-item{display:flex;align-items:center;padding:1rem;background:rgba(255,255,255,.05);border-radius:10px;margin-bottom:1rem}.item-actions,.quantity-btn{align-items:center;display:flex}.item-info h4{margin:0 0 .5rem;color:var(--text)}.empty-cart i,.item-info p,.order-success i,.order-summary h4,.profile-link:hover{color:var(--primary)}.item-info p{margin:0;font-weight:600}.item-actions{gap:.5rem}.quantity-btn{background:var(--primary);border:none;border-radius:50%;justify-content:center}.profile-link,.remove-btn{cursor:pointer;align-items:center}.remove-btn{background:#dc3545;border:none;border-radius:50%;display:flex;justify-content:center}.cart-total{text-align:center;padding:1rem;background:rgba(0,102,255,.1);border-radius:10px;margin-bottom:1rem}.empty-cart{text-align:center;padding:2rem;color:var(--text);opacity:.7}.empty-cart i{font-size:3rem;margin-bottom:1rem}.checkout-form{text-align:right}.order-summary{background:rgba(255,255,255,.05);padding:1rem;border-radius:10px;margin:1rem 0}.order-summary h4{margin-bottom:1rem}.order-item{display:flex;padding:.5rem 0;border-bottom:1px solid rgba(255,255,255,.1)}.order-total{display:flex;justify-content:space-between;padding-top:1rem;margin-top:1rem;border-top:2px solid var(--primary)}.form-actions,.modal-actions{display:flex;gap:1rem;margin-top:2rem}.order-success{text-align:center;padding:2rem}.order-success i{font-size:4rem;margin-bottom:1rem}.order-success h3{color:var(--text);margin-bottom:1rem}.order-success p{color:var(--text);opacity:.8;margin-bottom:2rem}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:var(--dark)}::-webkit-scrollbar-thumb{background:linear-gradient(var(--primary),var(--secondary));border-radius:10px}::-webkit-scrollbar-thumb:hover{background:linear-gradient(var(--secondary),var(--primary))}.loading-spinner{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:var(--primary);animation:1s ease-in-out infinite spin}.theme-toggle:hover{animation:2s infinite glow}.cart-btn.added{animation:.5s pulse}.product-card::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(45deg,transparent,rgba(0,102,255,.1),transparent);transform:translateX(-100%);transition:transform .6s}.product-card:hover::before{transform:translateX(100%)}.btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:.5s}.btn:hover::before{left:100%}.nav-links a::after{bottom:0;left:0;width:0;height:2px;transition:width .3s}.nav-links a:hover::after{width:100%}.checkout-form input:invalid{border-color:#dc3545!important}.checkout-form input:valid{border-color:#28a745!important}.checkout-form input:focus{border-color:var(--primary)!important;box-shadow:0 0 0 2px rgba(0,102,255,.2)!important}.btn:disabled{opacity:.6;cursor:not-allowed}.floating-image-container{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);padding:1.5rem;border-radius:20px;animation:3s ease-in-out infinite float;border:1px solid rgba(255,255,255,.2);box-shadow:0 10px 30px rgba(0,0,0,.3);position:relative;overflow:hidden}.floating-hero-image{width:100%;max-width:400px;height:auto;border-radius:15px;object-fit:cover;box-shadow:0 8px 25px rgba(0,0,0,.4);transition:.3s;border:2px solid rgba(0,102,255,.3)}.floating-image-container:hover .floating-hero-image{transform:scale(1.05);box-shadow:0 15px 35px rgba(0,102,255,.4);border-color:var(--primary)}.image-glow{position:absolute;top:-10px;left:-10px;right:-10px;bottom:-10px;background:linear-gradient(45deg,transparent,rgba(0,102,255,.1),transparent);border-radius:25px;z-index:-1;animation:2s ease-in-out infinite glow}.floating-image-container::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,rgba(0,102,255,.1),rgba(0,102,255,.05));border-radius:20px;z-index:-1}.hero-image{flex:1;position:relative;display:flex;justify-content:center;align-items:center}@keyframes float{0%,100%{transform:translateY(0);transform:translateY(0) rotate(0)}50%{transform:translateY(-20px);transform:translateY(-20px) rotate(1deg)}}@keyframes glow{0%,100%{opacity:.5;transform:scale(1)}50%{opacity:.8;transform:scale(1.02)}}.profile-link{display:block;width:100%;padding:.75rem;background:0 0;color:var(--text);border:none;text-align:right;border-bottom:1px solid rgba(255,255,255,.1);display:flex;gap:.5rem}.modal-overlay,.platform-tag{align-items:center;display:flex;backdrop-filter:blur(10px)}.profile-link:hover{background:rgba(0,102,255,.1)}.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);z-index:10000;justify-content:center;opacity:0;visibility:hidden}.modal-content{background:var(--dark);border:1px solid rgba(0,102,255,.3);border-radius:20px;padding:2rem;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;transform:scale(.9);transition:transform .3s}.chat-button,.chat-input button,.filter-btn,.modal-btn{transition:.3s;cursor:pointer}.modal-btn{flex:1;padding:1rem 2rem;border:none;border-radius:10px;font-weight:600}.btn-cancel{background:rgba(255,255,255,.1);color:var(--text);border:1px solid rgba(255,255,255,.2)}.modal-btn:hover{transform:translateY(-2px)}.product-platforms{position:absolute;top:10px;right:10px;display:flex;flex-direction:column;gap:5px;z-index:2}.platform-tag{padding:4px 8px;border-radius:15px;font-size:.7rem;font-weight:600;gap:4px;border:1px solid rgba(255,255,255,.2);animation:.5s ease-out slideUp}.platform-android{background:rgba(61,220,132,.9);color:#000}.platform-ios{background:rgba(0,0,0,.8);color:#fff}.platform-pc{background:rgba(0,120,215,.9);color:#fff}.platform-ps4,.platform-ps5{background:rgba(0,65,155,.9);color:#fff}.platform-xbox{background:rgba(16,124,16,.9);color:#fff}.chat-widget{position:fixed;bottom:20px;left:20px;z-index:1000}.chat-button{width:60px;height:60px;background:linear-gradient(135deg,var(--primary),var(--secondary));border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.5rem;box-shadow:0 5px 15px rgba(0,102,255,.4);animation:2s infinite pulse;position:relative}.chat-button:hover{transform:scale(1.1);box-shadow:0 8px 25px rgba(0,102,255,.6)}.chat-container{position:absolute;bottom:80px;left:0;width:350px;height:500px;background:var(--dark);border:1px solid rgba(0,102,255,.3);border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.3);display:none;flex-direction:column;backdrop-filter:blur(10px)}.chat-container.active{display:flex}.chat-header{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;padding:1rem;border-radius:15px 15px 0 0;display:flex;justify-content:space-between;align-items:center}.chat-header h4{margin:0;font-size:1.1rem}.close-chat{background:0 0;border:none;color:#fff;cursor:pointer;font-size:1.2rem}.chat-messages{flex:1;padding:1rem;overflow-y:auto;display:flex;flex-direction:column;gap:.5rem}.message{padding:.75rem;border-radius:10px;max-width:80%;word-wrap:break-word}.chat-input input,.message.user{border:1px solid rgba(0,102,255,.3)}.message.user{background:rgba(0,102,255,.2);align-self:flex-end}.message.support{background:rgba(255,255,255,.1);align-self:flex-start;border:1px solid rgba(255,255,255,.2)}.message-time{font-size:.7rem;opacity:.7;margin-top:.25rem}.chat-input{display:flex;padding:1rem;border-top:1px solid rgba(255,255,255,.1);gap:.5rem}.chat-input input{flex:1;padding:.75rem;background:rgba(255,255,255,.1);border-radius:10px;color:var(--text)}.chat-input button{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;border:none;border-radius:10px;padding:.75rem 1rem}.chat-notification-badge{position:absolute;top:-5px;right:-5px;background:#f44;color:#fff;border-radius:50%;width:20px;height:20px;font-size:.7rem;display:flex;align-items:center;justify-content:center}.filter-buttons{display:flex;justify-content:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.filter-btn{padding:.75rem 1.5rem;background:rgba(255,255,255,.05);border:1px solid rgba(0,102,255,.3);border-radius:50px;color:var(--text);display:flex;align-items:center;gap:.5rem;font-weight:600}.filter-btn:hover{background:rgba(0,102,255,.1);border-color:var(--primary);transform:translateY(-2px)}.filter-btn.active{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;border-color:var(--primary);box-shadow:0 5px 15px rgba(0,102,255,.3)}.checkout-form input[type=datetime-local]{direction:ltr;text-align:right}.checkout-form input[type=datetime-local]::-webkit-calendar-picker-indicator{filter:invert(.8);cursor:pointer}@media (max-width:768px){.nav,.nav-links{gap:1rem}.footer-content,.hero{text-align:center}.features-grid,.footer-content{grid-template-columns:1fr}.nav{flex-direction:column;padding:1rem}.hero{flex-direction:column;padding-top:8rem;gap:2rem}.hero-title{font-size:2.5rem}.hero-buttons{justify-content:center;flex-wrap:wrap}.about-content,.contact-content{padding:2rem 1rem}.contact-methods{flex-direction:column;align-items:center}.contact-btn{width:100%;justify-content:center}.products-grid:has(.product-card:nth-child(2):last-child){grid-template-columns:1fr}.products-grid:has(.product-card:only-child){grid-template-columns:1fr}.cart-modal-content{width:95%;padding:1rem}.cart-item{flex-direction:column;align-items:flex-start;gap:1rem}.item-actions{align-self:flex-end}.cart-actions,.form-actions{flex-direction:column}.cart-notification{right:10px;left:10px;transform:translateY(-100px)}.cart-notification.show{transform:translateY(0)}.login-container{padding:2rem 1.5rem}.nav-actions{flex-wrap:wrap;justify-content:center}.chat-container{width:300px;height:400px;left:10px;bottom:70px}.chat-widget{bottom:15px;left:15px}.chat-button{width:50px;height:50px;font-size:1.2rem}.filter-buttons{gap:.5rem}.filter-btn{padding:.6rem 1.2rem;font-size:.9rem}.checkout-form input[type=datetime-local]{font-size:16px}}@media (min-width:768px){.products-grid{grid-template-columns:repeat(2,1fr)}}@media (max-width:480px){.hero-title,.section-title{font-size:2rem}.btn{padding:.75rem 1.5rem;font-size:.9rem}.product-image-container{height:200px}.product-name{font-size:1.2rem}.product-price{font-size:1.3rem}.login-container{padding:1.5rem 1rem}.filter-buttons{flex-direction:column;align-items:center}.filter-btn{width:200px;justify-content:center}.main-content{padding:70px .5rem .5rem}.product-card{padding:.8rem}}@media (max-width:768px) and (orientation:landscape){.main-content{padding:60px 1rem 70px}.products-grid{grid-template-columns:repeat(3,1fr)}.product-image{height:80px}.product-image i{font-size:1.8rem}.nav-item span{display:none}.nav-item i{margin-bottom:0;font-size:1.3rem}}@supports (padding:max(0px)){.header{padding-top:max(1rem,env(safe-area-inset-top))}.bottom-nav{padding-bottom:max(.7rem,env(safe-area-inset-bottom))}.main-content{padding-left:max(1rem,env(safe-area-inset-left));padding-right:max(1rem,env(safe-area-inset-right))}}.touch-feedback{transition:.1s}.touch-feedback:active{transform:scale(.95);opacity:.8}.loading{display:inline-block;width:20px;height:20px;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:var(--primary);animation:1s ease-in-out infinite spin}@keyframes spin{to{transform:rotate(360deg)}}.notification{position:fixed;top:80px;right:1rem;left:1rem;background:var(--primary);color:#fff;padding:1rem;border-radius:10px;text-align:center;z-index:1001;transform:translateY(-100px);opacity:0;transition:.3s}.notification.show{transform:translateY(0);opacity:1}.copy-field-container{display:flex;gap:.5rem;align-items:stretch}.copy-field{flex:1;background:rgba(61,220,132,.1)!important;border:2px solid var(--android)!important;color:var(--android)!important;font-weight:700;text-align:center;direction:ltr}.copy-btn{background:var(--android)!important;color:#fff!important;border:none!important;border-radius:8px!important;padding:.75rem 1rem!important;cursor:pointer;transition:.3s;white-space:nowrap;display:flex;align-items:center;gap:.5rem}.copy-btn:hover{background:#34a853!important;transform:translateY(-2px)}.copy-btn:active{transform:scale(.95)}.copy-btn.copied{background:var(--primary)!important}.copy-btn.copied i::before{content:"✓"}.field-note{color:var(--android);font-size:.8rem;margin-top:.5rem;display:block;text-align:center}@media (max-width:480px){.copy-field-container{flex-direction:column}.copy-btn{width:100%;justify-content:center}}
        </style>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
        
        <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  
    </head>
    <body>
        <!-- شاشة تسجيل الدخول -->
        <div id="loginScreen" class="login-screen">
            <div class="login-container">
                <div class="login-header">
                    <i class="fas fa-gamepad"></i>
                    <h1>GAMA X CHEAT</h1>
                    <p>متجر الألعاب الاحترافي</p>
                </div>
                
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label for="email"><i class="fas fa-envelope"></i> البريد الإلكتروني</label>
                        <input type="email" id="email" required placeholder="ادخل بريدك الإلكتروني">
                    </div>
                    
                    <div class="form-group">
                        <label for="password"><i class="fas fa-lock"></i> كلمة المرور</label>
                        <input type="password" id="password" required placeholder="ادخل كلمة المرور">
                    </div>
                    
                    <button type="submit" class="btn primary login-btn">
                        <i class="fas fa-sign-in-alt"></i> تسجيل الدخول
                    </button>
                    
                    <div class="login-footer">
                        <p>ليس لديك حساب؟ <a href="#" id="showRegister">سجل الآن</a></p>
                    </div>
                </form>
                
                <form id="registerForm" class="login-form hidden">
                    <div class="form-group">
                        <label for="regName"><i class="fas fa-user"></i> الاسم الكامل</label>
                        <input type="text" id="regName" required placeholder="ادخل اسمك الكامل">
                    </div>
                    
                    <div class="form-group">
                        <label for="regEmail"><i class="fas fa-envelope"></i> البريد الإلكتروني</label>
                        <input type="email" id="regEmail" required placeholder="ادخل بريدك الإلكتروني">
                    </div>
                    
                    <div class="form-group">
                        <label for="regPassword"><i class="fas fa-lock"></i> كلمة المرور</label>
                        <input type="password" id="regPassword" required placeholder="ادخل كلمة المرور (6 أحرف على الأقل)">
                    </div>
                    
                    <div class="form-group">
                        <label for="regPhone"><i class="fas fa-phone"></i> رقم الهاتف</label>
                        <input type="tel" id="regPhone" required placeholder="ادخل رقم هاتفك">
                    </div>
                    
                    <button type="submit" class="btn primary login-btn">
                        <i class="fas fa-user-plus"></i> إنشاء حساب
                    </button>
                    
                    <div class="login-footer">
                        <p>لديك حساب بالفعل؟ <a href="#" id="showLogin">سجل الدخول</a></p>
                    </div>
                </form>
            </div>
        </div>

        <!-- الموقع الرئيسي (مخفي حتى تسجيل الدخول) -->
        <div id="mainSite" class="hidden">
            <header class="header">
                <nav class="nav">
                    <div class="logo">
                        <i class="fas fa-gamepad"></i>
                        <span>GAMA X CHEAT</span>
                    </div>
                    <div class="nav-links">
                        <a href="#home" class="active">الرئيسية</a>
                        <a href="#products">المنتجات</a>
                        <a href="#about">من نحن</a>
                        <a href="#testimonials">آراء العملاء</a>
                        <a href="#contact">اتصل بنا</a>
                    </div>
    <div class="nav-actions">
        <div class="user-profile">
            <button class="profile-btn">
                <i class="fas fa-user"></i>
                <span id="userName">المستخدم</span>
            </button>
            <div class="profile-dropdown">
                <div class="profile-info">
                    <strong id="dropdownUserName">المستخدم</strong>
                    <span id="dropdownUserEmail">user@example.com</span>
                </div>
                <a href="#" class="profile-link" id="openProfile">
                    <i class="fas fa-user-cog"></i> الملف الشخصي
                </a>
                <button id="logoutBtn" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
                </button>
            </div>
        </div>
        <button class="cart-btn">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count">0</span>
        </button>
        <button class="theme-toggle">
            <i class="fas fa-moon"></i>
        </button>
    </div>
                </nav>
            </header>
            
    <section id="home" class="hero">
        <div class="hero-content">
            <h1 class="hero-title">ارتقِ بمستوى ألعابك</h1>
            <p class="hero-description">اكتشف أحدث منتجات الألعاب والتعزيزات الرقمية لتتفوق على المنافسين</p>
            <div class="hero-buttons">
                <a href="#products" class="btn primary">تسوق الآن</a>
                <a href="#about" class="btn secondary">اعرف المزيد</a>
            </div>
        </div>
        <div class="hero-image">
            <!-- الصورة مع نفس تأثير الكارد العائم -->
            <div class="floating-image-container">
                <img src="https://yt3.googleusercontent.com/vWqEho11wngt1Eei_v73K2Jurqm-oCV3GqopCY5PIj7FAkdXTegOHpCXrznGNHeLOeOj-bcC=s160-c-k-c0x00ffffff-no-rj" alt="GAMA X CHEAT - متجر الألعاب" class="floating-hero-image">
                <div class="image-glow"></div>
            </div>
                    </div> <!-- إغلاق mainSite -->

        <!-- أضف هذا الكود هنا -->
        <!-- نظام الدردشة -->
        <div class="chat-widget">
            <div class="chat-button" id="chatToggle">
                <i class="fas fa-comments"></i>
                <span class="chat-notification-badge hidden">1</span>
            </div>
            <div class="chat-container" id="chatContainer">
                <div class="chat-header">
                    <h4><i class="fas fa-headset"></i> الدعم الفني</h4>
                    <button class="close-chat"><i class="fas fa-times"></i></button>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message support">
                        <div class="message-text">مرحباً! كيف يمكنني مساعدتك اليوم؟</div>
                        <div class="message-time">الآن</div>
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="messageInput" placeholder="اكتب رسالتك هنا..." maxlength="500">
                    <button id="sendMessage"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>

        </div>
    </section>
 
            <section id="about" class="about">
                <div class="container">
                    <h2 class="section-title">من نحن</h2>
                    <div class="about-content">
                        <div class="about-text">
                            <h3>GAMA X CHEAT - متجرك الموثوق لشحن الألعاب</h3>
                            <p>نحن متجر رائد في مجال شحن العملات الرقمية للألعاب، نقدم خدمات موثوقة وسريعة لعشاق الألعاب في مصر والعالم العربي.</p>
                            
                            <div class="features-grid">
                                <div class="feature-item">
                                    <i class="fas fa-shield-alt"></i>
                                    <h4>آمن وموثوق</h4>
                                    <p>خدماتنا مضمونة 100% مع ضمان استرجاع</p>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-bolt"></i>
                                    <h4>توصيل فوري</h4>
                                    <p>شحن خلال دقائق بعد التأكد من الدفع</p>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-headset"></i>
                                    <h4>دعم فني 24/7</h4>
                                    <p>فريق دعم متاح على مدار الساعة</p>
                                </div>
                            </div>

                            <div class="contact-info">
                                <h4>تواصل معنا:</h4>
                                <div class="contact-methods">
                                    <a href="https://wa.me/201011907743" class="contact-btn">
                                        <i class="fab fa-whatsapp"></i>
                                        واتساب جاما
                                    </a>
                                    <a href="https://wa.me/201011907743" class="contact-btn">
                                        <i class="fab fa-whatsapp"></i>
                                        واتساب جاما
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
 
            <section id="products" class="products">
    <div class="container">
        <h2 class="section-title">منتجاتنا المميزة</h2>
        
        <!-- أزرار التصفية -->
        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">
                <i class="fas fa-th-large"></i> الكل
            </button>
            <button class="filter-btn" data-filter="pc">
                <i class="fab fa-windows"></i> PC
            </button>
            <button class="filter-btn" data-filter="ios">
                <i class="fab fa-apple"></i> iOS
            </button>
            <button class="filter-btn" data-filter="android">
                <i class="fab fa-android"></i> Android
            </button>
        </div>
        
        <div class="products-grid" id="productsGrid">
            <div class="loading-product">
                <i class="fas fa-spinner fa-spin"></i>
                <p>جاري تحميل المنتجات...</p>
            </div>
        </div>
    </div>
</section>
<!-- 
            <section id="products" class="products">
                <div class="container">
                    <h2 class="section-title">منتجاتنا المميزة</h2>
                    <div class="products-grid" id="productsGrid">
                        <div class="loading-product">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>جاري تحميل المنتجات...</p>
                        </div>
                    </div>
                </div>
            </section> -->

            <section id="testimonials" class="testimonials">
                <div class="container">
                    <h2 class="section-title">آراء العملاء</h2>
                    
                    <div class="add-testimonial-form">
                        <h3>شاركنا برأيك</h3>
                        <form id="testimonialForm">
                            <div class="form-group">
                                <label for="customerName">اسمك:</label>
                                <input type="text" id="customerName" required placeholder="اكتب اسمك هنا">
                            </div>
                            <div class="form-group">
                                <label for="customerReview">رأيك:</label>
                                <textarea id="customerReview" required placeholder="اكتب رأيك عن خدماتنا..." rows="4"></textarea>
                            </div>
                            <div class="form-group">
                                <label>تقييمك:</label>
                                <div class="rating-stars">
                                    <span class="star" data-rating="1">★</span>
                                    <span class="star" data-rating="2">★</span>
                                    <span class="star" data-rating="3">★</span>
                                    <span class="star" data-rating="4">★</span>
                                    <span class="star" data-rating="5">★</span>
                                </div>
                                <input type="hidden" id="ratingValue" value="0">
                            </div>
                            <button type="submit" class="btn primary">إرسال الرأي</button>
                        </form>
                    </div>

                    <div class="testimonials-grid" id="testimonialsGrid">
                        <div class="loading-testimonials">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>جاري تحميل آراء العملاء...</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="contact" class="contact">
                <div class="container">
                    <h2 class="section-title">اتصل بنا</h2>
                    <div class="contact-content">
                        <div class="contact-info">
                            <div class="contact-item">
                                <i class="fab fa-whatsapp"></i>
                                <div>
                                    <h4>واتساب جاما</h4>
                                    <a href="https://wa.me/201011907743">01011907743</a>
                                </div>
                            </div>
                            <div class="contact-item">
                                <i class="fab fa-whatsapp"></i>
                                <div>
                                    <h4>واتساب جاما</h4>
                                    <a href="https://wa.me/201011907743">01011907743</a>
                                </div>
                            </div>
                            <div class="contact-item">
                                <i class="fas fa-clock"></i>
                                <div>
                                    <h4>ساعات العمل</h4>
                                    <p>24/7 متاحون لخدمتك</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <footer class="footer">
                <div class="container">
                    <div class="footer-content">
                        <div class="footer-section">
                            <h3>GAMA X CHEAT</h3>
                            <p>متجرك الموثوق لشحن الألعاب</p>
                        </div>
                        <div class="footer-section">
                            <h4>روابط سريعة</h4>
                            <a href="#home">الرئيسية</a>
                            <a href="#products">المنتجات</a>
                            <a href="#about">من نحن</a>
                            <a href="#contact">اتصل بنا</a>
                        </div>
                        <div class="footer-section">
                            <h4>التواصل</h4>
                            <a href="https://wa.me/201011907743">واتساب جاما</a>
                            <a href="https://wa.me/201011907743">واتساب جاما</a>
                        </div>
                    </div>
                    <div class="footer-bottom">
                        <p>&copy; 2025 GAMA X CHEAT. جميع الحقوق محفوظة</p>
                    </div>
                </div>
            </footer>

            <!-- مودال البروفايل -->
            <div id="profileModal" class="modal-overlay">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title"><i class="fas fa-user-cog"></i> الملف الشخصي</h3>
                        <button class="close-modal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <form id="profileForm">
                        <div class="form-group">
                            <label for="profileName"><i class="fas fa-user"></i> الاسم الكامل</label>
                            <input type="text" id="profileName" required placeholder="ادخل اسمك الكامل">
                        </div>
                        
                        <div class="form-group">
                            <label for="profileEmail"><i class="fas fa-envelope"></i> البريد الإلكتروني</label>
                            <input type="email" id="profileEmail" required placeholder="ادخل بريدك الإلكتروني" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label for="profilePhone"><i class="fas fa-phone"></i> رقم الهاتف</label>
                            <input type="tel" id="profilePhone" required placeholder="ادخل رقم هاتفك">
                        </div>
                        
                        <div class="form-group">
                            <label for="profileAddress"><i class="fas fa-map-marker-alt"></i> العنوان</label>
                            <textarea id="profileAddress" rows="3" placeholder="ادخل عنوانك"></textarea>
                        </div>
                        
                        <div class="modal-actions">
                            <button type="button" class="modal-btn btn-cancel" id="closeProfile">إلغاء</button>
                            <button type="submit" class="modal-btn btn-save">حفظ التغييرات</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>


        
        <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 الموقع اتحمل');
        initializeFirebase();
        setupAuth();
        setupEventListeners();
    });

    let cart = [];
    let currentUser = null;

    function initializeFirebase() {
        console.log('✅ Firebase اشتغل');
    }

    // نظام المصادقة
    function setupAuth() {
        // التحقق من حالة تسجيل الدخول
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                // المستخدم مسجل الدخول
                currentUser = user;
                showMainSite();
                loadUserData(user);
                loadProducts();
                loadTestimonials();
                loadCart();
            } else {
                // المستخدم غير مسجل الدخول
                showLoginScreen();
            }
        });
    }

    function showLoginScreen() {
        document.getElementById('loginScreen').classList.remove('hidden');
        document.getElementById('mainSite').classList.add('hidden');
    }

    function showMainSite() {
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('mainSite').classList.remove('hidden');
    }

    function loadUserData(user) {
        // تحديث اسم المستخدم في الواجهة
        const userNameElements = document.querySelectorAll('#userName, #dropdownUserName');
        const userEmailElement = document.getElementById('dropdownUserEmail');
        
        userNameElements.forEach(element => {
            element.textContent = user.displayName || 'المستخدم';
        });
        
        if (userEmailElement) {
            userEmailElement.textContent = user.email;
        }
    }

    // إعداد أحداث تسجيل الدخول والتسجيل
    function setupAuthEvents() {
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const showRegister = document.getElementById('showRegister');
        const showLogin = document.getElementById('showLogin');
        
        // تبديل بين نموذج التسجيل والدخول
        showRegister.addEventListener('click', function(e) {
            e.preventDefault();
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
        });
        
        showLogin.addEventListener('click', function(e) {
            e.preventDefault();
            registerForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        });
        
        // تسجيل الدخول
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            loginUser(email, password);
        });
        
        // إنشاء حساب جديد
        registerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const phone = document.getElementById('regPhone').value;
            
            registerUser(name, email, password, phone);
        });
        
        // تسجيل الخروج
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', logoutUser);
        }
    }

    function loginUser(email, password) {
        const loginBtn = document.querySelector('.login-btn');
        const originalText = loginBtn.innerHTML;
        
        loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري تسجيل الدخول...';
        loginBtn.disabled = true;
        
        firebase.auth().signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                console.log('✅ تم تسجيل الدخول بنجاح');
            })
            .catch((error) => {
                console.error('❌ خطأ في تسجيل الدخول:', error);
                alert('❌ خطأ في تسجيل الدخول: ' + error.message);
                
                // إعادة زر التسجيل
                loginBtn.innerHTML = originalText;
                loginBtn.disabled = false;
            });
    }

    function registerUser(name, email, password, phone) {
        const registerBtn = document.querySelector('#registerForm .login-btn');
        const originalText = registerBtn.innerHTML;
        
        registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري إنشاء الحساب...';
        registerBtn.disabled = true;
        
        firebase.auth().createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
                // تحديث ملف تعريف المستخدم
                return userCredential.user.updateProfile({
                    displayName: name
                }).then(() => {
                    // حفظ بيانات إضافية في Firestore
                    return db.collection('users').doc(userCredential.user.uid).set({
                        name: name,
                        email: email,
                        phone: phone,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                });
            })
            .then(() => {
                console.log('✅ تم إنشاء الحساب بنجاح');
            })
            .catch((error) => {
                console.error('❌ خطأ في إنشاء الحساب:', error);
                alert('❌ خطأ في إنشاء الحساب: ' + error.message);
                
                // إعادة زر التسجيل
                registerBtn.innerHTML = originalText;
                registerBtn.disabled = false;
            });
    }

    function logoutUser() {
        firebase.auth().signOut()
            .then(() => {
                console.log('✅ تم تسجيل الخروج');
                cart = [];
                saveCart();
            })
            .catch((error) => {
                console.error('❌ خطأ في تسجيل الخروج:', error);
            });
    }

    function loadProducts() {
        const productsGrid = document.getElementById('productsGrid');
        console.log('📦 بجيب المنتجات...');
        
        try {
            db.collection("products").orderBy("name").get()
                .then((querySnapshot) => {
                    console.log('📊 عدد المنتجات:', querySnapshot.size);
                    
                    if (querySnapshot.empty) {
                        console.log('❌ مفيش منتجات');
                        displayNoProducts();
                        return;
                    }
                    
                    const products = [];
                    querySnapshot.forEach((doc) => {
                        const productData = doc.data();
                        console.log('🎯 المنتج:', productData.name);
                        products.push({ 
                            id: doc.id, 
                            ...productData,
                            price: parseFloat(productData.price) || 0
                        });
                    });
                    
                    displayProducts(products);
                })
                .catch((error) => {
                    console.error("❌ غلطة في جلب المنتجات:", error);
                    displayNoProducts();
                });
        } catch (error) {
            console.error("❌ غلطة فادحة:", error);
            displayNoProducts();
        }
    }

    function displayNoProducts() {
        const productsGrid = document.getElementById('productsGrid');
        productsGrid.innerHTML = `
            <div class="no-products">
                <i class="fas fa-box-open"></i>
                <p>لا توجد منتجات متاحة حالياً</p>
                <p>سيتم إضافة المنتجات قريباً</p>
            </div>
        `;
    }

function displayProducts(products) {
    const productsGrid = document.getElementById('productsGrid');
    console.log('🎨 بعرض المنتجات:', products.length);
    
    const filteredProducts = products.filter(product => 
        product.name !== "Product 1" && 
        product.name !== "product 1" &&
        product.name !== "Product1"
    );
    
    if (filteredProducts.length === 0) {
        displayNoProducts();
        return;
    }
    
    productsGrid.innerHTML = filteredProducts.map(product => {
        const productName = product.name || 'منتج';
        const safeProductName = productName.replace(/'/g, "\\'").replace(/"/g, '\\"');
        const safeProductId = product.id.replace(/'/g, "\\'").replace(/"/g, '\\"');
        
        // تحديد منصة المنتج
        const platform = getProductPlatform(product.category || product.platform);
        const platformForFilter = getProductPlatformForFilter(product.category || product.platform);
        
        console.log('🛒 المنتج:', productName, 'الفئة:', product.category, 'المنصة:', platform);
        
        return `
        <div class="product-card" data-product-id="${product.id}" data-platform="${platformForFilter}">
            <div class="product-platforms">
                <span class="platform-tag platform-${platform.toLowerCase()}">
                    <i class="fab fa-${getPlatformIcon(platform)}"></i>
                    ${platform}
                </span>
            </div>
            <div class="product-image-container">
                ${product.image ? 
                    `<img src="${product.image}" alt="${productName}" class="product-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` :
                    ''
                }
                <div class="product-image-fallback ${product.image ? 'hidden' : ''}">
                    <span class="product-emoji">${getProductEmoji(product.category)}</span>
                </div>
            </div>
            <div class="product-info">
                <h3 class="product-name">${productName}</h3>
                <p class="product-description">${product.description || ''}</p>
                <div class="product-meta">
                    <span class="product-price">${product.price ? product.price + ' ج.م' : 'اسعار تنافسية'}</span>
                    <button class="add-to-cart" data-product-id="${safeProductId}" data-product-name="${safeProductName}" data-product-price="${product.price || 0}">
                        <i class="fas fa-shopping-cart"></i> أضف للسلة
                    </button>
                </div>
            </div>
        </div>
        `;
    }).join('');
    
    setupCartButtons();
    setupFilterButtons(); // إعداد أزرار التصفية بعد عرض المنتجات
}
// دالة محسنة لتحديد منصة المنتج بناءً على الفئة فقط
function getProductPlatform(category) {
    const platformMap = {
        // Android
        'android': 'Android',
        'اندرويد': 'Android',
        'mobile': 'Android',
        'موبايل': 'Android',
        'جوال': 'Android',
        'android games': 'Android',
        'العاب اندرويد': 'Android',
        
        // iOS
        'ios': 'iOS',
        'ايفون': 'iOS',
        'iphone': 'iOS',
        'apple': 'iOS',
        'ابل': 'iOS',
        'ios games': 'iOS',
        'العاب ايفون': 'iOS',
        
        // PC
        'pc': 'PC',
        'كمبيوتر': 'PC',
        'حاسوب': 'PC',
        'windows': 'PC',
        'ويندوز': 'PC',
        'computer': 'PC',
        'pc games': 'PC',
        'العاب كمبيوتر': 'PC',
        'العاب حاسوب': 'PC',
        
        // PlayStation
        'playstation': 'PS4',
        'بلايستيشن': 'PS4',
        'ps4': 'PS4',
        'ps5': 'PS5',
        'بلاي ستيشن': 'PS4',
        'playstation games': 'PS4',
        'العاب بلايستيشن': 'PS4',
        
        // Xbox
        'xbox': 'XBOX',
        'اكسبوكس': 'XBOX',
        'اكس بوكس': 'XBOX',
        'xbox games': 'XBOX',
        'العاب اكس بوكس': 'XBOX',
        
        // Nintendo
        'nintendo': 'Nintendo',
        'نينتندو': 'Nintendo',
        'switch': 'Nintendo',
        
        // الافتراضي
        'default': 'PC'
    };
    
    if (!category) {
        console.log('❌ لا توجد فئة للمنتج، استخدام الافتراضي');
        return platformMap.default;
    }
    
    const categoryLower = category.toLowerCase().trim();
    console.log('🔍 البحث في الفئة:', categoryLower);
    
    // البحث في الفئة فقط
    for (const [key, platform] of Object.entries(platformMap)) {
        if (categoryLower.includes(key)) {
            console.log('✅ تم العثور على المنصة:', platform, 'باستخدام الكلمة:', key);
            return platform;
        }
    }
    
    console.log('❌ لم يتم العثور على منصة مناسبة في الفئة، استخدام الافتراضي');
    return platformMap.default;
}

    // دالة للحصول على أيقونة المنصة
    function getPlatformIcon(platform) {
        const iconMap = {
            'Android': 'android',
            'iOS': 'apple',
            'PC': 'windows',
            'PS4': 'playstation',
            'PS5': 'playstation',
            'XBOX': 'xbox'
        };
        
        return iconMap[platform] || 'desktop';
    }

    function setupCartButtons() {
        console.log('🔗 بربط أزرار السلة...');
        const addToCartButtons = document.querySelectorAll('.add-to-cart');
        
        addToCartButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                if (!currentUser) {
                    alert('⚠️ يرجى تسجيل الدخول لإضافة منتجات إلى السلة');
                    return;
                }
                
                const productId = this.getAttribute('data-product-id');
                const productName = this.getAttribute('data-product-name');
                const productPrice = parseFloat(this.getAttribute('data-product-price'));
                
                console.log('🛒 ضغطت على إضافة:', { productId, productName, productPrice });
                
                addToCart(productId, productName, productPrice);
            });
        });
        
        console.log('✅ اتربط عدد أزرار:', addToCartButtons.length);
    }

    function getProductEmoji(category) {
        const emojis = {
            'Gaming': '🎮',
            'Electronics': '📱',
            'Accessories': '🎧',
            'Software': '💻',
            'Subscription': '🔄',
            'default': '🎁'
        };
        return emojis[category] || emojis.default;
    }

    function addToCart(productId, productName, productPrice) {
        console.log('🛒 بضيف للسلة:', { productId, productName, productPrice });
        
        if (!productId || !productName) {
            console.error('❌ بيانات المنتج ناقصة');
            return;
        }
        
        if (isNaN(productPrice)) {
            productPrice = 0;
            console.warn('⚠️ السعر مش رقم، استخدمت 0');
        }
        
        const existingItem = cart.find(item => item.id === productId);
        
        if (existingItem) {
            existingItem.quantity += 1;
            console.log('➕ زودت الكمية:', existingItem.quantity);
        } else {
            cart.push({
                id: productId,
                name: productName,
                price: productPrice,
                quantity: 1
            });
            console.log('🆕 منتج جديد في السلة');
        }
        
        saveCart();
        updateCartCount();
        showCartNotification(productName);
    }

    function showCartNotification(productName) {
        console.log('🔔 بعمل إشعار:', productName);
        
        const oldNotification = document.querySelector('.cart-notification');
        if (oldNotification) {
            document.body.removeChild(oldNotification);
        }
        
        const notification = document.createElement('div');
        notification.className = 'cart-notification';
        notification.innerHTML = `
            <i class="fas fa-check"></i>
            تم إضافة "${productName}" إلى السلة
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.classList.add('show');
        }, 100);
        
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }

    function saveCart() {
        const userCartKey = currentUser ? `mxl_cart_${currentUser.uid}` : 'mxl_cart';
        localStorage.setItem(userCartKey, JSON.stringify(cart));
        console.log('💾 خزنت السلة:', cart);
    }

    function loadCart() {
        const userCartKey = currentUser ? `mxl_cart_${currentUser.uid}` : 'mxl_cart';
        const savedCart = localStorage.getItem(userCartKey);
        if (savedCart) {
            try {
                cart = JSON.parse(savedCart);
                updateCartCount();
                console.log('📥 السلة اتحملت:', cart);
            } catch (error) {
                console.error('❌ غلطة في تحميل السلة:', error);
                cart = [];
            }
        } else {
            console.log('🆕 السلة فاضية أول مرة');
        }
    }

    function updateCartCount() {
        const cartCount = document.querySelector('.cart-count');
        if (cartCount) {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            console.log('🔢 عدد السلة اتحدد:', totalItems);
        }
    }

    function toggleCart() {
        console.log('🛒 فتح السلة');
        showCartModal();
    }

    function showCartModal() {
        console.log('🎪 بعمل مودال السلة');
        
        const oldModal = document.querySelector('.cart-modal');
        if (oldModal) {
            document.body.removeChild(oldModal);
        }
        
        const modal = document.createElement('div');
        modal.className = 'cart-modal';
        modal.innerHTML = `
            <div class="cart-modal-content">
                <div class="cart-modal-header">
                    <h3>🛒 سلة التسوق</h3>
                    <button class="close-cart">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="cart-items" id="cartItems">
                    ${renderCartItems()}
                </div>
                <div class="cart-total">
                    <strong>💰 الإجمالي: ${calculateTotal()} ج.م</strong>
                </div>
                <div class="cart-actions">
                    <button class="btn secondary" id="continueShopping">🛍️ متابعة التسوق</button>
                    <button class="btn primary" id="checkoutBtn">✅ إتمام الطلب</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        modal.querySelector('.close-cart').addEventListener('click', closeCartModal);
        modal.querySelector('#continueShopping').addEventListener('click', closeCartModal);
        modal.querySelector('#checkoutBtn').addEventListener('click', showCheckoutForm);
        
        setupCartModalEvents();
        
        setTimeout(() => {
            modal.classList.add('show');
        }, 100);
    }

    function renderCartItems() {
        console.log('📋 برسم محتويات السلة:', cart.length);
        
        if (cart.length === 0) {
            return `
                <div class="empty-cart">
                    <i class="fas fa-shopping-cart"></i>
                    <p>السلة فارغة</p>
                    <p>ابدأ بإضافة بعض المنتجات!</p>
                </div>
            `;
        }
        
        return cart.map(item => {
            const safeId = item.id.replace(/'/g, "\\'").replace(/"/g, '\\"');
            return `
            <div class="cart-item">
                <div class="item-info">
                    <h4>${item.name}</h4>
                    <p>${item.price} ج.م × ${item.quantity}</p>
                    <small>المجموع: ${item.price * item.quantity} ج.م</small>
                </div>
                <div class="item-actions">
                    <button class="quantity-btn" data-product-id="${safeId}" data-action="decrease">-</button>
                    <span class="quantity">${item.quantity}</span>
                    <button class="quantity-btn" data-product-id="${safeId}" data-action="increase">+</button>
                    <button class="remove-btn" data-product-id="${safeId}" title="حذف">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            `;
        }).join('');
    }

    function setupCartModalEvents() {
        document.querySelectorAll('.quantity-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const productId = this.getAttribute('data-product-id');
                const action = this.getAttribute('data-action');
                const item = cart.find(item => item.id === productId);
                
                if (item) {
                    if (action === 'increase') {
                        item.quantity += 1;
                    } else if (action === 'decrease') {
                        item.quantity -= 1;
                    }
                    
                    if (item.quantity < 1) {
                        removeFromCart(productId);
                    } else {
                        saveCart();
                        updateCartCount();
                        updateCartModal();
                    }
                }
            });
        });
        
        document.querySelectorAll('.remove-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const productId = this.getAttribute('data-product-id');
                removeFromCart(productId);
            });
        });
    }

    function removeFromCart(productId) {
        console.log('🗑️ بحذف من السلة:', productId);
        cart = cart.filter(item => item.id !== productId);
        saveCart();
        updateCartCount();
        updateCartModal();
        
        if (cart.length === 0) {
            setTimeout(() => {
                closeCartModal();
            }, 1000);
        }
    }

    function calculateTotal() {
        const total = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        return total.toFixed(2);
    }

    function updateCartModal() {
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.querySelector('.cart-total');
        
        if (cartItems) {
            cartItems.innerHTML = renderCartItems();
            setupCartModalEvents();
        }
        
        if (cartTotal) {
            cartTotal.innerHTML = `<strong>💰 الإجمالي: ${calculateTotal()} ج.م</strong>`;
        }
    }

    function closeCartModal() {
        console.log('❌ بقفل السلة');
        const modal = document.querySelector('.cart-modal');
        if (modal) {
            modal.classList.remove('show');
            setTimeout(() => {
                if (document.body.contains(modal)) {
                    document.body.removeChild(modal);
                }
            }, 300);
        }
    }

function showCheckoutForm() {
    if (!currentUser) {
        alert('⚠️ يرجى تسجيل الدخول لإتمام الطلب');
        return;
    }
    
    const modal = document.querySelector('.cart-modal');
    if (modal) {
        modal.querySelector('.cart-modal-content').innerHTML = `
            <div class="cart-modal-header">
                <h3>📋 إتمام الطلب</h3>
                <button class="close-cart">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="form-group">
    <label for="transferToPhone">📱 رقم التحويل *</label>
    <div class="copy-field-container">
        <input type="text" id="transferToPhone" value="01011907743" readonly class="copy-field">
        <button type="button" class="copy-btn" onclick="copyTransferNumber()">
            <i class="fas fa-copy"></i> نسخ
        </button>
    </div>
    <small class="field-note">انسخ هذا الرقم للتحويل إليه</small>
</div>

            <form id="checkoutForm" class="checkout-form">
                <div class="form-group">
                    <label for="checkoutCustomerName">👤 الاسم بالكامل *</label>
                    <input type="text" id="checkoutCustomerName" required placeholder="ادخل اسمك بالكامل">
                </div>
                <div class="form-group">
                    <label for="checkoutCustomerPhone">📞 رقم الهاتف *</label>
                    <input type="tel" id="checkoutCustomerPhone" required placeholder="ادخل رقم هاتفك">
                </div>
                <div class="form-group">
                    <label for="checkoutCustomerEmail">📧 البريد الإلكتروني</label>
                    <input type="email" id="checkoutCustomerEmail" placeholder="example@email.com" value="${currentUser.email || ''}">
                </div>
                
                <!-- الحقول الجديدة -->
                <div class="form-group">
                    <label for="transferFromPhone">📱 رقم الهاتف المحول منه *</label>
                    <input type="tel" id="transferFromPhone" required placeholder="ادخل رقم الهاتف الذي حولت منه">
                </div>
                <div class="form-group">
                    <label for="transferTime">🕒 توقيت التحويل *</label>
                    <input type="datetime-local" id="transferTime" required>
                </div>
                
                <div class="form-group">
                    <label for="checkoutOrderNotes">📝 ملاحظات إضافية</label>
                    <textarea id="checkoutOrderNotes" rows="3" placeholder="أي متطلبات خاصة بالطلب..."></textarea>
                </div>
                <div class="order-summary">
                    <h4>🛍️ ملخص الطلب:</h4>
                    ${cart.map(item => `
                        <div class="order-item">
                            <span>${item.name}</span>
                            <span>${item.quantity} × ${item.price} ج.م</span>
                        </div>
                    `).join('')}
                    <div class="order-total">
                        <strong>💰 الإجمالي: ${calculateTotal()} ج.م</strong>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn secondary" id="backToCart">↩️ الرجوع للسلة</button>
                    <button type="submit" class="btn primary">🚀 إرسال الطلب</button>
                </div>
            </form>
        `;

        // إعداد القيمة الافتراضية لتوقيت التحويل (الوقت الحالي)
        const now = new Date();
        const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
        document.getElementById('transferTime').value = localDateTime;

        // إعادة ربط الأحداث
        modal.querySelector('.close-cart').addEventListener('click', closeCartModal);
        modal.querySelector('#backToCart').addEventListener('click', showCartModal);
        
        // إضافة event listener للنموذج
        const checkoutForm = document.getElementById('checkoutForm');
        if (checkoutForm) {
            checkoutForm.addEventListener('submit', function(e) {
                e.preventDefault();
                submitOrder();
            });
        }
    }
}

function submitOrder() {
    console.log('🔄 بجرب أرسل الطلب...');
    
    // استخدام IDs الجديدة
    const customerName = document.getElementById('checkoutCustomerName');
    const customerPhone = document.getElementById('checkoutCustomerPhone');
    const transferFromPhone = document.getElementById('transferFromPhone');
    const transferTime = document.getElementById('transferTime');
    
    if (!customerName || !customerPhone || !transferFromPhone || !transferTime) {
        console.error('❌ العناصر مش موجودة في الـ DOM');
        alert('⚠️ حدث خطأ في النموذج، يرجى تحديث الصفحة');
        return;
    }
    
    const nameValue = customerName.value.trim();
    const phoneValue = customerPhone.value.trim();
    const transferFromValue = transferFromPhone.value.trim();
    const transferTimeValue = transferTime.value;
    
    console.log('📝 البيانات المدخلة:', { 
        name: nameValue, 
        phone: phoneValue,
        transferFrom: transferFromValue,
        transferTime: transferTimeValue
    });
    
    // تحقق أكثر دقة من الحقول الإلزامية
    let hasError = false;
    let errorMessage = '⚠️ يرجى ملء الحقول الإلزامية:\n';
    
    if (!nameValue) {
        customerName.style.borderColor = 'red';
        hasError = true;
        errorMessage += '- الاسم بالكامل\n';
    } else {
        customerName.style.borderColor = '';
    }
    
    if (!phoneValue) {
        customerPhone.style.borderColor = 'red';
        hasError = true;
        errorMessage += '- رقم الهاتف\n';
    } else {
        // تحقق من صحة رقم الهاتف (يجب أن يكون أرقام فقط)
        const phoneRegex = /^[0-9]+$/;
        if (!phoneRegex.test(phoneValue)) {
            customerPhone.style.borderColor = 'red';
            hasError = true;
            errorMessage += '- رقم الهاتف غير صحيح (يجب أن يحتوي على أرقام فقط)\n';
        } else if (phoneValue.length < 10) {
            customerPhone.style.borderColor = 'red';
            hasError = true;
            errorMessage += '- رقم الهاتف قصير جداً\n';
        } else {
            customerPhone.style.borderColor = '';
        }
    }
    
    if (!transferFromValue) {
        transferFromPhone.style.borderColor = 'red';
        hasError = true;
        errorMessage += '- رقم الهاتف المحول منه\n';
    } else {
        // تحقق من صحة رقم الهاتف المحول منه
        const phoneRegex = /^[0-9]+$/;
        if (!phoneRegex.test(transferFromValue)) {
            transferFromPhone.style.borderColor = 'red';
            hasError = true;
            errorMessage += '- رقم الهاتف المحول منه غير صحيح (يجب أن يحتوي على أرقام فقط)\n';
        } else if (transferFromValue.length < 10) {
            transferFromPhone.style.borderColor = 'red';
            hasError = true;
            errorMessage += '- رقم الهاتف المحول منه قصير جداً\n';
        } else {
            transferFromPhone.style.borderColor = '';
        }
    }
    
    if (!transferTimeValue) {
        transferTime.style.borderColor = 'red';
        hasError = true;
        errorMessage += '- توقيت التحويل\n';
    } else {
        transferTime.style.borderColor = '';
    }
    
    if (hasError) {
        alert(errorMessage);
        return;
    }
    
    // إزالة الحدود الحمراء إذا البيانات كاملة
    customerName.style.borderColor = '';
    customerPhone.style.borderColor = '';
    transferFromPhone.style.borderColor = '';
    transferTime.style.borderColor = '';
    
    // تحويل توقيت التحويل إلى كائن تاريخ
    const transferDateTime = new Date(transferTimeValue);
    
   const orderData = {
                customerName: nameValue,
                customerPhone: phoneValue,
                customerEmail: document.getElementById('checkoutCustomerEmail')?.value.trim() || currentUser.email || '',
                transferFromPhone: transferFromValue,
                transferTime: transferDateTime,
                orderNotes: document.getElementById('checkoutOrderNotes')?.value.trim() || '',
                items: cart,
                total: parseFloat(calculateTotal()),
                status: 'pending',
                userId: currentUser.uid,
                userEmail: currentUser.email,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                orderNumber: generateOrderNumber() // سيتم إنشاء رقم فريد الآن
            };
    console.log('📤 بيانات الطلب:', orderData);
    
    // عرض رسالة تحميل
    const submitBtn = document.querySelector('#checkoutForm .btn.primary');
    if (submitBtn) {
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الإرسال...';
        submitBtn.disabled = true;
    }
    
    // حفظ الطلب في Firebase
    db.collection("orders").add(orderData)
        .then((docRef) => {
            console.log("✅ الطلب اتبعت بنجاح:", docRef.id);
            showOrderSuccess(orderData.orderNumber);
            cart = [];
            saveCart();
            updateCartCount();
        })
        .catch((error) => {
            console.error("❌ غلطة في إرسال الطلب:", error);
            alert('⚠️ حدث خطأ في إرسال الطلب، حاول مرة أخرى');
            
            // إعادة زر الإرسال
            if (submitBtn) {
                submitBtn.innerHTML = '🚀 إرسال الطلب';
                submitBtn.disabled = false;
            }
        });
}

// دالة محسنة لإنشاء رقم طلب فريد حقاً
function generateOrderNumber() {
            const timestamp = Date.now().toString(36);
            const random = Math.random().toString(36).substr(2, 9);
            const userPart = currentUser ? currentUser.uid.substr(0, 4) : 'GUEST';
            const counter = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            
            return `GS-${timestamp}-${random}-${counter}`.toUpperCase();
        }

    function showOrderSuccess(orderNumber) {
        const modal = document.querySelector('.cart-modal');
        if (modal) {
            modal.querySelector('.cart-modal-content').innerHTML = `
                <div class="order-success">
                    <i class="fas fa-check-circle"></i>
                    <h3>🎉 تم إرسال طلبك بنجاح!</h3>
                    <p>سيتم التواصل معك خلال دقائق لتأكيد الطلب</p>
                    <p>رقم طلبك: <strong>${orderNumber}</strong></p>
                    <button class="btn primary" id="closeSuccess">موافق</button>
                </div>
            `;
            
            // ربط زر الموافق
            modal.querySelector('#closeSuccess').addEventListener('click', closeCartModal);
        }
    }

    function loadTestimonials() {
        const testimonialsGrid = document.getElementById('testimonialsGrid');
        
        try {
            db.collection("testimonials").orderBy("timestamp", "desc").limit(20)
                .get()
                .then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        displayNoTestimonials();
                        return;
                    }
                    
                    const testimonials = [];
                    querySnapshot.forEach((doc) => {
                        testimonials.push({ id: doc.id, ...doc.data() });
                    });
                    
                    displayTestimonials(testimonials);
                })
                .catch((error) => {
                    console.error("Error loading testimonials: ", error);
                    displayNoTestimonials();
                });
        } catch (error) {
            console.error("Firebase error: ", error);
            displayNoTestimonials();
        }
    }

    function displayNoTestimonials() {
        const testimonialsGrid = document.getElementById('testimonialsGrid');
        testimonialsGrid.innerHTML = `
            <div class="no-testimonials">
                <i class="fas fa-comment-alt"></i>
                <p>لا توجد آراء متاحة حالياً</p>
                <p>كن أول من يشارك برأيه!</p>
            </div>
        `;
    }

    function displayTestimonials(testimonials) {
        const testimonialsGrid = document.getElementById('testimonialsGrid');
        
        testimonialsGrid.innerHTML = testimonials.map(testimonial => {
            const date = testimonial.timestamp?.toDate ? 
                        testimonial.timestamp.toDate().toLocaleDateString('ar-EG') : 
                        new Date().toLocaleDateString('ar-EG');
            
            const stars = '★'.repeat(testimonial.rating || 5) + '☆'.repeat(5 - (testimonial.rating || 5));
            
            return `
                <div class="testimonial-card">
                    <div class="testimonial-header">
                        <div class="testimonial-author">
                            <div class="author-avatar">${(testimonial.name || 'م').charAt(0)}</div>
                            <div class="author-info">
                                <h4>${testimonial.name || 'عميل'}</h4>
                                <div class="author-rating">${stars}</div>
                            </div>
                        </div>
                    </div>
                    <div class="testimonial-text">${testimonial.review || 'رأي العميل'}</div>
                    <div class="testimonial-date">${date}</div>
                </div>
            `;
        }).join('');
    }

    function addTestimonialToFirebase(name, review, rating) {
        const testimonialData = {
            name: name,
            review: review,
            rating: parseInt(rating),
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        db.collection("testimonials").add(testimonialData)
            .then((docRef) => {
                console.log("Testimonial added with ID: ", docRef.id);
                loadTestimonials();
            })
            .catch((error) => {
                console.error("Error adding testimonial: ", error);
                alert('⚠️ حدث خطأ في إضافة الرأي، حاول مرة أخرى');
            });
    }

    // فتح مودال البروفايل
    function openProfileModal() {
        if (!currentUser) return;
        
        // تحميل بيانات المستخدم
        db.collection('users').doc(currentUser.uid).get()
            .then((doc) => {
                if (doc.exists) {
                    const userData = doc.data();
                    document.getElementById('profileName').value = userData.name || '';
                    document.getElementById('profileEmail').value = currentUser.email || '';
                    document.getElementById('profilePhone').value = userData.phone || '';
                    document.getElementById('profileAddress').value = userData.address || '';
                }
            })
            .catch((error) => {
                console.error("Error loading user data:", error);
            });
        
        document.getElementById('profileModal').classList.add('active');
    }

    // إغلاق مودال البروفايل
    function closeProfileModal() {
        document.getElementById('profileModal').classList.remove('active');
    }

    // حفظ بيانات البروفايل
    function saveProfile(e) {
        e.preventDefault();
        
        const name = document.getElementById('profileName').value.trim();
        const phone = document.getElementById('profilePhone').value.trim();
        const address = document.getElementById('profileAddress').value.trim();
        
        if (!name) {
            alert('⚠️ يرجى إدخال الاسم الكامل');
            return;
        }
        
        const userData = {
            name: name,
            phone: phone,
            address: address,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        // تحديث بيانات المستخدم في Firestore
        db.collection('users').doc(currentUser.uid).set(userData, { merge: true })
            .then(() => {
                // تحديث الاسم المعروض
                const userNameElements = document.querySelectorAll('#userName, #dropdownUserName');
                userNameElements.forEach(element => {
                    element.textContent = name;
                });
                
                alert('✅ تم حفظ التغييرات بنجاح');
                closeProfileModal();
            })
            .catch((error) => {
                console.error("Error saving profile:", error);
                alert('❌ حدث خطأ في حفظ البيانات');
            });
    }

function setupEventListeners() {
    console.log('🔗 بربط الأحداث...');
    setupAuthEvents();
    setupStarRating();
    setupTestimonialForm();
    setupThemeToggle();
    setupSmoothScrolling();
    
    const cartBtn = document.querySelector('.cart-btn');
    if (cartBtn) {
        cartBtn.addEventListener('click', toggleCart);
        console.log('✅ زر السلة اتربط');
    }
    
    // أحداث البروفايل
    document.getElementById('openProfile').addEventListener('click', function(e) {
        e.preventDefault();
        openProfileModal();
    });
    
    document.getElementById('closeProfile').addEventListener('click', closeProfileModal);
    document.querySelector('.close-modal').addEventListener('click', closeProfileModal);
    document.getElementById('profileForm').addEventListener('submit', saveProfile);
    
    // إغلاق المودال عند النقر خارج المحتوى
    document.getElementById('profileModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeProfileModal();
        }
    });
    
    // ⭐⭐ إضافة نظام الدردشة هنا ⭐⭐
    // نظام الدردشة المحسن
function setupChat() {
    const chatToggle = document.getElementById('chatToggle');
    const chatContainer = document.getElementById('chatContainer');
    const closeChat = document.querySelector('.close-chat');
    const sendMessageBtn = document.getElementById('sendMessage');
    const messageInput = document.getElementById('messageInput');
    
    if (!chatToggle) {
        console.error('❌ زر الدردشة مش موجود في الـ DOM');
        return;
    }
    
    // فتح/إغلاق الدردشة
    chatToggle.addEventListener('click', function() {
        chatContainer.classList.toggle('active');
        if (chatContainer.classList.contains('active')) {
            messageInput.focus();
            loadOrCreateChat(); // إنشاء أو تحميل المحادثة عند فتح الدردشة
        }
    });
    
    closeChat.addEventListener('click', function() {
        chatContainer.classList.remove('active');
    });
    
    // إرسال رسالة
    sendMessageBtn.addEventListener('click', sendChatMessage);
    messageInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendChatMessage();
        }
    });
}

// إنشاء أو تحميل محادثة المستخدم
async function loadOrCreateChat() {
    if (!currentUser) return;

    console.log('🔄 جاري إنشاء/تحميل المحادثة...');
    
    try {
        // البحث عن محادثة موجودة للمستخدم
        const existingChat = await db.collection("support_requests")
            .where("userId", "==", currentUser.uid)
            .limit(1)
            .get();

        let chatId;

        if (!existingChat.empty) {
            // استخدام المحادثة الموجودة
            chatId = existingChat.docs[0].id;
            console.log('✅ وجدت محادثة موجودة:', chatId);
        } else {
            // إنشاء محادثة جديدة
            const chatData = {
                userId: currentUser.uid,
                name: currentUser.displayName || 'مستخدم',
                phone: '', // يمكن إضافة رقم الهاتف من البروفايل لاحقاً
                email: currentUser.email,
                status: 'pending',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            const newChat = await db.collection("support_requests").add(chatData);
            chatId = newChat.id;
            console.log('✅ تم إنشاء محادثة جديدة:', chatId);
            
            // إضافة رسالة ترحيب
            await db.collection("support_requests").doc(chatId).collection("messages").add({
                text: "مرحباً! كيف يمكنني مساعدتك اليوم؟",
                sender: "admin",
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
        }

        // تحميل الرسائل
        loadChatMessages(chatId);
        
    } catch (error) {
        console.error('❌ خطأ في إنشاء/تحميل المحادثة:', error);
    }
}

// تحميل رسائل المحادثة
function loadChatMessages(chatId) {
    console.log('📨 جاري تحميل رسائل المحادثة:', chatId);
    
    const chatMessages = document.getElementById('chatMessages');
    chatMessages.innerHTML = '<div class="message support"><div class="message-text">جاري تحميل المحادثة...</div></div>';

    // الاستماع للرسائل الجديدة في الوقت الحقيقي
    db.collection("support_requests")
        .doc(chatId)
        .collection("messages")
        .orderBy("timestamp", "asc")
        .onSnapshot((snapshot) => {
            console.log('🔄 تم تحديث الرسائل:', snapshot.size, 'رسالة');
            chatMessages.innerHTML = '';
            
            if (snapshot.empty) {
                chatMessages.innerHTML = `
                    <div class="message support">
                        <div class="message-text">مرحباً! كيف يمكنني مساعدتك اليوم؟</div>
                        <div class="message-time">الآن</div>
                    </div>
                `;
                return;
            }
            
            snapshot.forEach((doc) => {
                const message = doc.data();
                const messageDiv = document.createElement('div');
                
                const date = message.timestamp?.toDate ? 
                    message.timestamp.toDate().toLocaleString('ar-EG') : 
                    new Date().toLocaleString('ar-EG');
                
                messageDiv.className = `message ${message.sender === 'user' ? 'user' : 'support'}`;
                messageDiv.innerHTML = `
                    <div class="message-text">${message.text}</div>
                    <div class="message-time">${date}</div>
                `;
                
                chatMessages.appendChild(messageDiv);
            });
            
            // التمرير إلى أحدث رسالة
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }, (error) => {
            console.error("❌ خطأ في تحميل الرسائل:", error);
            chatMessages.innerHTML = `
                <div class="message support">
                    <div class="message-text">حدث خطأ في تحميل المحادثة</div>
                </div>
            `;
        });
}

// إرسال رسالة جديدة
async function sendChatMessage() {
    const messageInput = document.getElementById('messageInput');
    const messageText = messageInput.value.trim();
    
    if (!messageText) {
        alert('⚠️ يرجى كتابة رسالة');
        return;
    }
    
    if (!currentUser) {
        alert('⚠️ يرجى تسجيل الدخول لإرسال رسائل');
        return;
    }
    
    console.log('📤 جاري إرسال رسالة:', messageText);
    
    try {
        // البحث عن محادثة المستخدم
        const existingChat = await db.collection("support_requests")
            .where("userId", "==", currentUser.uid)
            .limit(1)
            .get();

        if (existingChat.empty) {
            alert('❌ لم يتم العثور على المحادثة، يرجى إعادة فتح الدردشة');
            return;
        }

        const chatId = existingChat.docs[0].id;
        
        // إضافة الرسالة إلى قاعدة البيانات
        await db.collection("support_requests")
            .doc(chatId)
            .collection("messages")
            .add({
                text: messageText,
                sender: 'user',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });

        console.log('✅ تم إرسال الرسالة بنجاح');
        messageInput.value = '';
        
        // تحديث حالة المحادثة
        await db.collection("support_requests")
            .doc(chatId)
            .update({
                status: 'in-progress',
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            });

    } catch (error) {
        console.error("❌ خطأ في إرسال الرسالة:", error);
        alert('❌ حدث خطأ في إرسال الرسالة، حاول مرة أخرى');
    }
}
    setupChat();
}

    function setupStarRating() {
        const stars = document.querySelectorAll('.star');
        const ratingValue = document.getElementById('ratingValue');
        
        stars.forEach(star => {
            star.addEventListener('click', function() {
                const rating = this.getAttribute('data-rating');
                ratingValue.value = rating;
                
                stars.forEach(s => {
                    if (s.getAttribute('data-rating') <= rating) {
                        s.classList.add('active');
                    } else {
                        s.classList.remove('active');
                    }
                });
            });
        });
    }

    function setupTestimonialForm() {
        const testimonialForm = document.getElementById('testimonialForm');
        
        if (testimonialForm) {
            testimonialForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('customerName').value.trim();
                const review = document.getElementById('customerReview').value.trim();
                const rating = document.getElementById('ratingValue').value;
                
                if (!name || !review || rating === '0') {
                    alert('⚠️ يرجى ملء جميع الحقول وتحديد التقييم');
                    return;
                }
                
                addTestimonialToFirebase(name, review, rating);
                
                testimonialForm.reset();
                document.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
                document.getElementById('ratingValue').value = '0';
                
                alert('🎉 شكراً لك! تم إضافة رأيك بنجاح');
            });
        }
    }

    function setupThemeToggle() {
        const themeToggle = document.querySelector('.theme-toggle');
        
        if (themeToggle) {
            themeToggle.addEventListener('click', function() {
                const currentTheme = document.body.getAttribute('data-theme');
                
                if (currentTheme === 'dark') {
                    document.body.removeAttribute('data-theme');
                    localStorage.setItem('theme', 'light');
                    this.innerHTML = '<i class="fas fa-moon"></i>';
                } else {
                    document.body.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                    this.innerHTML = '<i class="fas fa-sun"></i>';
                }
            });
            
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                document.querySelector('.theme-toggle').innerHTML = '<i class="fas fa-sun"></i>';
            }
        }
    }

    function setupSmoothScrolling() {
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({
                        behavior: 'smooth'
                    });
                }
            });
        });
    }
    // نظام الدردشة المحسن
    function setupChat() {
        const chatToggle = document.getElementById('chatToggle');
        const chatContainer = document.getElementById('chatContainer');
        const closeChat = document.querySelector('.close-chat');
        const sendMessageBtn = document.getElementById('sendMessage');
        const messageInput = document.getElementById('messageInput');
        
        if (!chatToggle) {
            console.error('❌ زر الدردشة مش موجود في الـ DOM');
            return;
        }
        
        // فتح/إغلاق الدردشة
        chatToggle.addEventListener('click', function() {
            chatContainer.classList.toggle('active');
            if (chatContainer.classList.contains('active')) {
                messageInput.focus();
                loadChatHistory(); // تحميل الرسائل عند فتح الدردشة
            }
        });
        
        closeChat.addEventListener('click', function() {
            chatContainer.classList.remove('active');
        });
        
        // إرسال رسالة
        sendMessageBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // الاستماع للرسائل الجديدة في الوقت الحقيقي
        setupChatListener();
    }

    function sendMessage() {
        const messageInput = document.getElementById('messageInput');
        const message = messageInput.value.trim();
        
        if (!message) {
            alert('⚠️ يرجى كتابة رسالة');
            return;
        }
        
        if (!currentUser) {
            alert('⚠️ يرجى تسجيل الدخول لإرسال رسائل');
            return;
        }
        
        console.log('🔄 بجرب أرسل رسالة:', message);
        
        // إضافة الرسالة للواجهة فوراً
        addMessageToChat(message, 'user', new Date());
        
        // حفظ الرسالة في Firebase
        const chatData = {
            userId: currentUser.uid,
            userName: currentUser.displayName || 'مستخدم',
            userEmail: currentUser.email,
            message: message,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            type: 'user',
            read: false
        };
        
        db.collection("chat_messages").add(chatData)
            .then((docRef) => {
                console.log("✅ تم إرسال الرسالة بنجاح:", docRef.id);
                messageInput.value = '';
                
                // إشعار للإدمن
                notifyAdminNewMessage(message);
            })
            .catch((error) => {
                console.error("❌ خطأ في إرسال الرسالة:", error);
                alert('❌ حدث خطأ في إرسال الرسالة، حاول مرة أخرى');
            });
    }

    function addMessageToChat(message, sender, timestamp) {
        const chatMessages = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}`;
        
        const time = timestamp.toLocaleTimeString('ar-EG', { 
            hour: '2-digit', 
            minute: '2-digit' 
        });
        
        messageDiv.innerHTML = `
            <div class="message-text">${message}</div>
            <div class="message-time">${time}</div>
        `;
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function setupChatListener() {
        if (!currentUser) return;
        
        console.log('👂 بستمع للرسائل للمستخدم:', currentUser.uid);
        
        // الاستماع للرسائل الجديدة في الوقت الحقيقي
        db.collection("chat_messages")
            .where("userId", "==", currentUser.uid)
            .orderBy("timestamp", "asc")
            .onSnapshot((snapshot) => {
                console.log('📨 في رسائل جديدة:', snapshot.size);
                
                const chatMessages = document.getElementById('chatMessages');
                
                // مسح فقط إذا كانت أول مرة
                if (!chatMessages.dataset.loaded) {
                    chatMessages.innerHTML = '';
                    chatMessages.dataset.loaded = 'true';
                }
                
                snapshot.docChanges().forEach((change) => {
                    if (change.type === "added") {
                        const messageData = change.doc.data();
                        console.log('📩 رسالة جديدة:', messageData);
                        
                        // تحويل timestamp
                        let messageDate;
                        if (messageData.timestamp && messageData.timestamp.toDate) {
                            messageDate = messageData.timestamp.toDate();
                        } else {
                            messageDate = new Date();
                        }
                        
                        addMessageToChat(messageData.message, messageData.type, messageDate);
                    }
                });
            }, (error) => {
                console.error("❌ خطأ في الاستماع للرسائل:", error);
            });
    }

    function loadChatHistory() {
        if (!currentUser) return;
        
        console.log('📂 بجلب تاريخ المحادثة...');
        
        db.collection("chat_messages")
            .where("userId", "==", currentUser.uid)
            .orderBy("timestamp", "asc")
            .get()
            .then((querySnapshot) => {
                console.log('📊 عدد الرسائل:', querySnapshot.size);
                
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.innerHTML = '';
                
                // رسالة ترحيب افتراضية
                if (querySnapshot.empty) {
                    const welcomeMsg = document.createElement('div');
                    welcomeMsg.className = 'message support';
                    welcomeMsg.innerHTML = `
                        <div class="message-text">مرحباً! كيف يمكنني مساعدتك اليوم؟</div>
                        <div class="message-time">الآن</div>
                    `;
                    chatMessages.appendChild(welcomeMsg);
                }
                
                querySnapshot.forEach((doc) => {
                    const messageData = doc.data();
                    let messageDate;
                    
                    if (messageData.timestamp && messageData.timestamp.toDate) {
                        messageDate = messageData.timestamp.toDate();
                    } else {
                        messageDate = new Date();
                    }
                    
                    addMessageToChat(messageData.message, messageData.type, messageDate);
                });
            })
            .catch((error) => {
                console.error("❌ خطأ في تحميل المحادثة:", error);
            });
    }


    // دالة لإنشاء هيكل بيانات اختبار
function createTestSupportData() {
    console.log('🔄 جاري إنشاء بيانات اختبار للدعم الفني...');
    
    const chatData = {
        name: "محمد أحمد",
        phone: "01011907743",
        status: "pending",
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    // إنشاء محادثة جديدة
    db.collection("support_requests").add(chatData)
        .then((docRef) => {
            const chatId = docRef.id;
            console.log('✅ تم إنشاء محادثة جديدة:', chatId);
            
            // إضافة رسالة من المستخدم
            return db.collection("support_requests").doc(chatId).collection("messages").add({
                text: "مرحباً، أريد مساعدة في شحن لعبة فورتنايت",
                sender: "user",
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
        })
        .then(() => {
            console.log('✅ تم إضافة رسالة اختبار');
            showNotification('نجاح', 'تم إنشاء بيانات اختبار للدعم الفني', 'success');
            
            // إعادة تحميل قائمة الدعم
            loadSupportRequests();
        })
        .catch((error) => {
            console.error('❌ خطأ في إنشاء بيانات الاختبار:', error);
            showNotification('خطأ', 'فشل في إنشاء بيانات الاختبار', 'error');
        });
}

// دالة للتحقق من هيكل البيانات
async function checkDatabaseStructure() {
    try {
        console.log('🔍 التحقق من هيكل قاعدة البيانات...');
        
        // التحقق من وجود مجموعة support_requests
        const supportSnapshot = await db.collection("support_requests").limit(1).get();
        
        if (supportSnapshot.empty) {
            console.log('⚠️ مجموعة support_requests فارغة');
            return false;
        }
        
        // التحقق من وجود رسائل في أول محادثة
        const firstChat = supportSnapshot.docs[0];
        const messagesSnapshot = await db.collection("support_requests")
            .doc(firstChat.id)
            .collection("messages")
            .limit(1)
            .get();
        
        console.log('📊 إحصائيات قاعدة البيانات:');
        console.log('- عدد المحادثات:', supportSnapshot.size);
        console.log('- عدد الرسائل في المحادثة الأولى:', messagesSnapshot.size);
        
        return true;
    } catch (error) {
        console.error('❌ خطأ في التحقق من الهيكل:', error);
        return false;
    }
}

// إضافة أزرار التحكم في وحدة التحكم
function addDatabaseControls() {
    if (document.getElementById('dbControls')) return;
    
    const controlsDiv = document.createElement('div');
    controlsDiv.id = 'dbControls';
    controlsDiv.style.cssText = `
        position: fixed;
        bottom: 70px;
        left: 20px;
        background: rgba(15, 26, 47, 0.95);
        border: 1px solid rgba(33, 150, 243, 0.3);
        border-radius: 10px;
        padding: 15px;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        gap: 10px;
        min-width: 200px;
        backdrop-filter: blur(10px);
    `;
    
    controlsDiv.innerHTML = `
        <h4 style="margin: 0 0 10px 0; color: var(--primary); text-align: center;">تحكم قاعدة البيانات</h4>
        <button id="createTestData" style="
            background: var(--success);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Tajawal', sans-serif;
        ">إنشاء بيانات اختبار</button>
        <button id="checkStructure" style="
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Tajawal', sans-serif;
        ">فحص الهيكل</button>
        <button id="clearTestData" style="
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Tajawal', sans-serif;
        ">مسح البيانات</button>
    `;
    
    document.body.appendChild(controlsDiv);
    
    // ربط الأحداث
    document.getElementById('createTestData').addEventListener('click', createTestSupportData);
    document.getElementById('checkStructure').addEventListener('click', checkDatabaseStructure);
    document.getElementById('clearTestData').addEventListener('click', clearTestData);
}

// دالة لمسح بيانات الاختبار
function clearTestData() {
    showConfirmModal(
        'مسح بيانات الاختبار',
        'هل أنت متأكد من مسح جميع بيانات الدعم الفني؟ هذا الإجراء لا يمكن التراجع عنه!',
        async () => {
            try {
                console.log('🗑️ جاري مسح بيانات الاختبار...');
                
                // الحصول على جميع محادثات الدعم
                const snapshot = await db.collection("support_requests").get();
                
                const deletePromises = [];
                snapshot.forEach((doc) => {
                    // مسح جميع الرسائل أولاً
                    const messagesPromise = db.collection("support_requests")
                        .doc(doc.id)
                        .collection("messages")
                        .get()
                        .then((messagesSnapshot) => {
                            const messageDeletes = [];
                            messagesSnapshot.forEach((msgDoc) => {
                                messageDeletes.push(msgDoc.ref.delete());
                            });
                            return Promise.all(messageDeletes);
                        })
                        .then(() => {
                            // ثم مسح المحادثة نفسها
                            return doc.ref.delete();
                        });
                    
                    deletePromises.push(messagesPromise);
                });
                
                await Promise.all(deletePromises);
                console.log('✅ تم مسح جميع بيانات الدعم الفني');
                showNotification('تم المسح', 'تم مسح جميع بيانات الدعم الفني بنجاح', 'success');
                
                // إعادة تحميل القائمة
                loadSupportRequests();
            } catch (error) {
                console.error('❌ خطأ في مسح البيانات:', error);
                showNotification('خطأ في المسح', 'تعذر مسح البيانات', 'error');
            }
        }
    );
}
// دالة لإعداد أزرار التصفية
function setupFilterButtons() {
    const filterButtons = document.querySelectorAll('.filter-btn');
    let allProducts = []; // لتخزين جميع المنتجات
    
    console.log('🔘 إعداد أزرار التصفية...');
    
    // جمع جميع المنتجات عند التحميل
    function collectAllProducts() {
        const productCards = document.querySelectorAll('.product-card');
        allProducts = Array.from(productCards);
        console.log('📦 تم جمع المنتجات:', allProducts.length);
    }
    
    // تصفية المنتجات
    function filterProducts(filter) {
        console.log('🎯 تطبيق التصفية:', filter);
        
        const productCards = allProducts.length > 0 ? allProducts : 
                           document.querySelectorAll('.product-card');
        
        let visibleCount = 0;
        
        productCards.forEach(card => {
            const cardPlatform = getCardPlatform(card);
            
            if (filter === 'all' || cardPlatform === filter) {
                card.style.display = 'flex';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });
        
        console.log('👀 عدد المنتجات المعروضة:', visibleCount);
        
        // إذا لم توجد منتجات، عرض رسالة
        showNoProductsMessage(visibleCount === 0, filter);
    }
    
    // الحصول على منصة المنتج من الكارد
    function getCardPlatform(card) {
        const platformTag = card.querySelector('.platform-tag');
        if (platformTag) {
            const platformText = platformTag.textContent.toLowerCase().trim();
            return platformText;
        }
        return 'all';
    }
    
    // عرض رسالة عدم وجود منتجات
    function showNoProductsMessage(show, filter) {
        // إزالة أي رسالة موجودة مسبقاً
        const existingMessage = document.querySelector('.no-products-filtered');
        if (existingMessage) {
            existingMessage.remove();
        }
        
        if (show) {
            const productsGrid = document.getElementById('productsGrid');
            const message = document.createElement('div');
            message.className = 'no-products-filtered';
            message.innerHTML = `
                <div class="no-products">
                    <i class="fas fa-search"></i>
                    <p>لا توجد منتجات في قسم ${getFilterName(filter)}</p>
                    <p>سيتم إضافة منتجات قريباً</p>
                </div>
            `;
            productsGrid.appendChild(message);
        }
    }
    
    // الحصول على اسم التصفية بالعربية
    function getFilterName(filter) {
        const filterNames = {
            'all': 'الكل',
            'pc': 'الكمبيوتر',
            'ios': 'iOS',
            'android': 'Android'
        };
        return filterNames[filter] || filter;
    }
    
    // إضافة event listeners للأزرار
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            // إزالة النشاط من جميع الأزرار
            filterButtons.forEach(btn => btn.classList.remove('active'));
            
            // إضافة النشاط للزر المحدد
            this.classList.add('active');
            
            // تطبيق التصفية
            const filter = this.getAttribute('data-filter');
            filterProducts(filter);
        });
    });
    
    // جمع المنتجات بعد تحميلها
    setTimeout(collectAllProducts, 1000);
}

// دالة محسنة لتحديد منصة المنتج (للاستخدام في التصفية)
function getProductPlatformForFilter(category) {
    const platformMap = {
        // Android
        'android': 'android',
        'اندرويد': 'android',
        'mobile': 'android',
        'موبايل': 'android',
        'جوال': 'android',
        
        // iOS
        'ios': 'ios',
        'ايفون': 'ios',
        'iphone': 'ios',
        'apple': 'ios',
        'ابل': 'ios',
        
        // PC
        'pc': 'pc',
        'كمبيوتر': 'pc',
        'حاسوب': 'pc',
        'windows': 'pc',
        'ويندوز': 'pc',
        'computer': 'pc',
        
        // PlayStation
        'playstation': 'ps4',
        'بلايستيشن': 'ps4',
        'ps4': 'ps4',
        'ps5': 'ps5',
        'بلاي ستيشن': 'ps4',
        
        // Xbox
        'xbox': 'xbox',
        'اكسبوكس': 'xbox',
        'اكس بوكس': 'xbox',
        
        'default': 'pc'
    };
    
    if (!category) {
        return platformMap.default;
    }
    
    const categoryLower = category.toLowerCase().trim();
    
    for (const [key, platform] of Object.entries(platformMap)) {
        if (categoryLower.includes(key)) {
            return platform;
        }
    }
    
    return platformMap.default;
}
    function notifyAdminNewMessage(message) {
        if (!currentUser) return;
        
        const notificationData = {
            userId: currentUser.uid,
            userName: currentUser.displayName || 'مستخدم',
            userEmail: currentUser.email,
            message: message,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            read: false,
            type: 'new_message'
        };
        
        db.collection("admin_notifications").add(notificationData)
            .then(() => {
                console.log("🔔 تم إرسال إشعار للإدمن");
            })
            .catch((error) => {
                console.error("❌ خطأ في إرسال الإشعار:", error);
            });
    }
    // دالة نسخ رقم التحويل
function copyTransferNumber() {
    const transferField = document.getElementById('transferToPhone');
    const copyBtn = document.querySelector('.copy-btn');
    
    if (!transferField) {
        console.error('❌ حقل النسخ مش موجود');
        return;
    }
    
    // اختيار النص
    transferField.select();
    transferField.setSelectionRange(0, 99999); // للجوال
    
    try {
        // نسخ النص
        navigator.clipboard.writeText(transferField.value)
            .then(() => {
                console.log('✅ تم نسخ الرقم:', transferField.value);
                
                // تغيير مظهر الزر
                if (copyBtn) {
                    const originalHTML = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> تم النسخ!';
                    copyBtn.classList.add('copied');
                    
                    // العودة للحالة الأصلية بعد 2 ثانية
                    setTimeout(() => {
                        copyBtn.innerHTML = originalHTML;
                        copyBtn.classList.remove('copied');
                    }, 2000);
                }
                
                // إظهار إشعار
                showCopyNotification();
            })
            .catch(err => {
                console.error('❌ فشل النسخ:', err);
                fallbackCopy(transferField);
            });
    } catch (err) {
        console.error('❌ خطأ في النسخ:', err);
        fallbackCopy(transferField);
    }
}

// طريقة بديلة للنسخ
function fallbackCopy(textField) {
    textField.select();
    document.execCommand('copy');
    console.log('✅ تم النسخ بالطريقة البديلة');
    showCopyNotification();
}

// إشعار النسخ
function showCopyNotification() {
    // إزالة أي إشعارات قديمة
    const oldNotification = document.querySelector('.copy-notification');
    if (oldNotification) {
        document.body.removeChild(oldNotification);
    }
    
    const notification = document.createElement('div');
    notification.className = 'copy-notification';
    notification.innerHTML = `
        <i class="fas fa-check-circle"></i>
        <span>تم نسخ رقم التحويل بنجاح!</span>
    `;
    
    // إضافة أنماط الإشعار
    notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: var(--android);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        z-index: 10001;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        animation: slideInRight 0.3s ease-out;
    `;
    
    document.body.appendChild(notification);
    
    // إخفاء الإشعار بعد 3 ثوان
    setTimeout(() => {
        if (document.body.contains(notification)) {
            notification.style.animation = 'slideOutRight 0.3s ease-in';
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 300);
        }
    }, 3000);
}

// إضافة أنيميشن للإشعار
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOutRight {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
`;
document.head.appendChild(style);
    console.log('🎯 السكربت اتحمل كامل وجاهز');
        </script>



        <script>

let firebaseApp = null;
let db = null;


function initializeFirebase() {
   
    
    // إذا الملف الآمن موجود، استخدمه
    if (typeof window.firebaseConfig !== 'undefined') {
        console.log('✅ استخدام الإعدادات من الملف الآمن');
        startFirebase(window.firebaseConfig);
    } else {
        // جرب تحميل الملف الآمن
       
        loadFirebaseConfig();
    }
}

// تحميل الملف الآمن
function loadFirebaseConfig() {
    const script = document.createElement('script');
    script.src = './FUCK YOU';
    script.onload = function() {
        console.log('✅ تم تحميل الملف الآمن بنجاح');
        if (window.firebaseConfig) {
            startFirebase(window.firebaseConfig);
        } else {
            showFirebaseError();
        }
    };
    script.onerror = function() {
        console.error('❌ فشل تحميل الملف الآمن');
        showFirebaseError();
    };
    document.head.appendChild(script);
}

// بدء Firebase
function startFirebase(config) {
    try {
        console.log('🎯 تهيئة Firebase...');
        firebaseApp = firebase.initializeApp(config);
        db = firebase.firestore();
        
        console.log('✅ Firebase اشتغل بنجاح!');
        console.log('📊 قاعدة البيانات:', db);
        
        // بدء التطبيق
        startApplication();
        
    } catch (error) {
        console.error('❌ خطأ في Firebase:', error);
        showFirebaseError();
    }
}

// عرض خطأ Firebase
function showFirebaseError() {
    console.error('🚨 لم يتم تحميل Firebase بشكل صحيح');
    // يمكنك إضافة رسالة للمستخدم إذا تريد
}

// بدء التطبيق بعد اكتمال Firebase
function startApplication() {
    console.log('🎉 بدء التطبيق الرئيسي...');
    
    // تأكد من وجود الدوال قبل استدعائها
    if (typeof setupAuth === 'function') {
        setupAuth();
    } else {
        console.log('⚠️ setupAuth غير موجود');
    }
    
    if (typeof setupEventListeners === 'function') {
        setupEventListeners();
    } else {
        console.log('⚠️ setupEventListeners غير موجود');
    }
    
    // تحميل البيانات
    loadInitialData();
}

// تحميل البيانات الأولية
function loadInitialData() {
    console.log('📦 جاري تحميل البيانات...');
    
    if (db) {
        // جرب جلب منتج علشان تتأكد إن الداتابيز شغالة
        db.collection("products").limit(1).get()
            .then((querySnapshot) => {
                console.log('✅ الاتصال بقاعدة البيانات ناجح');
                console.log('📊 عدد المنتجات:', querySnapshot.size);
            })
            .catch((error) => {
                console.error('❌ خطأ في قاعدة البيانات:', error);
            });
    }
}

// =============================================
// بدء التطبيق عندما الصفحة تتحمل
// =============================================
document.addEventListener('DOMContentLoaded', function() {
    console.log('📄 الصفحة اتحملت - بدء النظام');
    initializeFirebase();
});

// =============================================
// دوال مساعدة للوصول لـ Firebase من أي مكان
// =============================================
function getFirestore() {
    return db;
}

function getFirebaseAuth() {
    return firebaseApp ? firebase.auth() : null;
}

function getCurrentUser() {
    return firebaseApp ? firebase.auth().currentUser : null;
}
</script>
    </body>

    </html>
